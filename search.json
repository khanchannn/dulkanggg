[{"title":"Fail2Ban: Protecting Your Server","slug":"fail2ban","date":"2025-12-05","tags":["ubuntu","vps","security","network","bilingual","fail2ban"],"body":"> *üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).*\r\n\r\n---\r\n\r\n### Fail2Ban: The Diligent \"Bodyguard\" Protecting Your Server\r\n\r\nHello everyone! If you operate a server (VPS/Dedicated), you surely know that uneasy feeling of seeing thousands of unauthorized login attempts (brute-force) hitting your system daily.\r\n\r\nDon't worry, Fail2Ban was born to solve this. Think of Fail2Ban as a security guard who reads your server logs 24/7. The moment he spots suspicious activity (like too many wrong passwords), he immediately signals the Firewall to \"lock out\" that intruder.\r\n\r\nToday, I‚Äôll guide you from A to Z on how to install and use this amazing tool.\r\n\r\n### 1. Installation (Easy as Pie)\r\n\r\nOn popular operating systems like Ubuntu or Debian, you only need one command:\r\n\r\n```bash\r\nsudo apt install fail2ban\r\n```\r\n\r\n### 2. Configuration: The Rules of the Game\r\n\r\nThis is the most important part. Fail2Ban has a very cool configuration principle: It reads `.conf` files first, but it will prioritize `.local` files.\r\n\r\n**Tip:** Never edit the `.conf` file directly. Copy it to a `.local` file to edit. This helps you keep the original file intact and prevents losing your configuration when the software updates.\r\n\r\nCreate a local configuration file:\r\n\r\n```bash\r\nsudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local\r\n```\r\n\r\nNow open the `/etc/fail2ban/jail.local` file and edit the core parameters:\r\n\r\n*   **ignoreip**: The \"Death Exemption\" list. Enter your own IP or your company's IP here to avoid accidentally locking yourself out if you type the wrong password.\r\n*   **bantime**: The \"Jail time\" (in seconds). Default is 600s (10 minutes). I usually increase this to 3600s or more just to be safe.\r\n*   **findtime & maxretry**: This is the \"Three strikes and you're out\" rule. Example: Within the `findtime` window (10 minutes), if there are more than `maxretry` (3) failed attempts, then BAN.\r\n\r\n**Example SSH protection configuration:**\r\nBy default, SSH is enabled, but you should double-check the `[ssh]` block:\r\n\r\n```ini\r\n[ssh]\r\nenabled  = true\r\nport     = ssh      # If you changed your SSH port (e.g., 2222), enter 2222 here\r\nfilter   = sshd\r\nlogpath  = /var/log/auth.log\r\nmaxretry = 3\r\n```\r\n\r\n### 3. Advanced: Creating Custom Filters for Websites\r\n\r\nFail2Ban doesn't just protect SSH; it can protect Nginx, Apache, or even your WordPress login page. The principle is using Regex (Regular Expressions) to scan logs. For example, let's say you want to block someone trying to brute-force `wp-login.php`.\r\n\r\n**Step 1: Check the log**\r\nSee what traces the attacker leaves. Example in `/var/log/nginx/access.log`:\r\n`123.123.123.123 ... \"POST /wp-login.php HTTP/1.1\" 200 ...`\r\n\r\n**Step 2: Write the Regex**\r\nWe will translate the log line above into a language Fail2Ban understands:\r\n`<HOST> - - \\[(\\d{2})/\\w{3}/\\d{4}:\\1:\\1:\\1 -\\d{4}\\] \"POST /wp-login.php HTTP/1.1\" 200`\r\n\r\n**Step 3: Create a new filter**\r\nCreate the file `/etc/fail2ban/filter.d/wordpress.conf`:\r\n\r\n```ini\r\n[Definition]\r\nfailregex = <HOST> - - \\[(\\d{2})/\\w{3}/\\d{4}:\\1:\\1:\\1 -\\d{4}\\] \"POST /wp-login.php HTTP/1.1\" 200\r\nignoreregex =\r\n```\r\n\r\nThen remember to restart the service:\r\n\r\n```bash\r\nsudo service fail2ban restart\r\n```\r\n\r\n### 4. Management and Monitoring\r\n\r\nOnce installed, you need to know what it's actually doing, right?\r\n\r\n**See how many \"bad guys\" Fail2Ban has caught:**\r\n\r\n```bash\r\nsudo fail2ban-client status\r\n```\r\n\r\n**See the list of IPs currently blocked in the firewall:**\r\n\r\n```bash\r\nsudo iptables -L -n -v\r\n```\r\n\r\n### 5. For Pros: Installing the Latest Version from Source\r\n\r\nSometimes the repository (Repo) on Ubuntu/Debian is a bit outdated. If you want the latest features (like better IPv6 support), install it manually.\r\n\r\n**Step 1: Remove the old version**\r\n\r\n```bash\r\nsudo apt purge fail2ban\r\n```\r\n\r\n**Step 2: Download and Install**\r\nVisit the Fail2Ban Github to get the link for the latest version, then:\r\n\r\n```bash\r\n# Download and extract (e.g., version 0.10.4)\r\ntar xvfj fail2ban-0.10.4.tar.bz2\r\ncd fail2ban-0.10.4\r\n\r\n# Install via Python\r\nsudo python setup.py install\r\n```\r\n\r\n**Step 3: Create a System Boot Service**\r\nSince you installed it manually, you need to copy the init script yourself:\r\n\r\n```bash\r\ncp files/debian-initd /etc/init.d/fail2ban\r\nupdate-rc.d fail2ban defaults\r\nservice fail2ban start\r\n```\r\n\r\nThen verify it with the command `fail2ban-client version` and you're done!\r\n\r\n---\r\n\r\n### Fail2Ban: Ch√†ng \"V·ªá sƒ©\" C·∫ßn M·∫´n B·∫£o V·ªá Server C·ªßa B·∫°n\r\n\r\nCh√†o m·ªçi ng∆∞·ªùi! N·∫øu b·∫°n ƒëang v·∫≠n h√†nh m·ªôt server (VPS/Dedicated), ch·∫Øc h·∫≥n b·∫°n bi·∫øt c·∫£m gi√°c b·∫•t an khi h√†ng ng√†y c√≥ h√†ng ng√†n l∆∞·ª£t c·ªë g·∫Øng ƒëƒÉng nh·∫≠p tr√°i ph√©p (brute-force) v√†o h·ªá th·ªëng.\r\n\r\nƒê·ª´ng lo, Fail2Ban sinh ra l√† ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y. H√£y t∆∞·ªüng t∆∞·ª£ng Fail2Ban nh∆∞ m·ªôt ng∆∞·ªùi b·∫£o v·ªá ng·ªìi ƒë·ªçc nh·∫≠t k√Ω (logs) c·ªßa server 24/7. H·ªÖ th·∫•y ai c√≥ d·∫•u hi·ªáu kh·∫£ nghi (nh∆∞ g√µ sai m·∫≠t kh·∫©u qu√° nhi·ªÅu l·∫ßn), anh ta s·∫Ω l·∫≠p t·ª©c b√°o cho t∆∞·ªùng l·ª≠a (Firewall) \"c·∫•m c·ª≠a\" k·∫ª ƒë√≥ ngay l·∫≠p t·ª©c.\r\n\r\nH√¥m nay m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n t·ª´ A-Z c√°ch c√†i ƒë·∫∑t v√† s·ª≠ d·ª•ng c√¥ng c·ª• tuy·ªát v·ªùi n√†y nh√©.\r\n\r\n### 1. C√†i ƒë·∫∑t (D·ªÖ nh∆∞ ƒÉn k·∫πo)\r\n\r\nTr√™n c√°c h·ªá ƒëi·ªÅu h√†nh ph·ªï bi·∫øn nh∆∞ Ubuntu hay Debian, b·∫°n ch·ªâ c·∫ßn m·ªôt c√¢u l·ªánh:\r\n\r\n```bash\r\nsudo apt install fail2ban\r\n```\r\n\r\n### 2. C·∫•u h√¨nh: Quy t·∫Øc c·ªßa tr√≤ ch∆°i\r\n\r\nƒê√¢y l√† ph·∫ßn quan tr·ªçng nh·∫•t. Fail2Ban c√≥ m·ªôt nguy√™n t·∫Øc c·∫•u h√¨nh r·∫•t hay: N√≥ ƒë·ªçc file `.conf` tr∆∞·ªõc, nh∆∞ng s·∫Ω ∆∞u ti√™n file `.local`.\r\n\r\n**M·∫πo:** ƒê·ª´ng bao gi·ªù s·ª≠a tr·ª±c ti·∫øp file `.conf`. H√£y copy ra file `.local` ƒë·ªÉ s·ª≠a. ƒêi·ªÅu n√†y gi√∫p b·∫°n gi·ªØ nguy√™n file g·ªëc v√† kh√¥ng b·ªã m·∫•t c·∫•u h√¨nh khi c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm.\r\n\r\nT·∫°o file c·∫•u h√¨nh local:\r\n\r\n```bash\r\nsudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local\r\n```\r\n\r\nB√¢y gi·ªù h√£y m·ªü file `/etc/fail2ban/jail.local` v√† ch·ªânh s·ª≠a c√°c th√¥ng s·ªë c·ªët l√µi:\r\n\r\n*   **ignoreip**: Danh s√°ch c√°c IP \"ƒë∆∞·ª£c mi·ªÖn t·ª≠\". H√£y ƒëi·ªÅn IP c·ªßa ch√≠nh b·∫°n ho·∫∑c c√¥ng ty v√†o ƒë√¢y ƒë·ªÉ tr√°nh tr∆∞·ªùng h·ª£p l·ª° tay g√µ sai m·∫≠t kh·∫©u m√† t·ª± nh·ªët m√¨nh ·ªü ngo√†i.\r\n*   **bantime**: Th·ªùi gian \"ƒëi t√π\" (t√≠nh b·∫±ng gi√¢y). M·∫∑c ƒë·ªãnh l√† 600s (10 ph√∫t). M√¨nh th∆∞·ªùng tƒÉng l√™n 3600s ho·∫∑c h∆°n cho ch·∫Øc ƒÉn.\r\n*   **findtime & maxretry**: ƒê√¢y l√† lu·∫≠t \"qu√° tam ba b·∫≠n\". V√≠ d·ª•: Trong kho·∫£ng th·ªùi gian `findtime` (10 ph√∫t), n·∫øu ƒëƒÉng nh·∫≠p sai qu√° `maxretry` (3 l·∫ßn) th√¨ BAN.\r\n\r\n**V√≠ d·ª• c·∫•u h√¨nh b·∫£o v·ªá SSH:**\r\nM·∫∑c ƒë·ªãnh SSH ƒë√£ ƒë∆∞·ª£c b·∫≠t, nh∆∞ng b·∫°n n√™n ki·ªÉm tra l·∫°i ƒëo·∫°n c·∫•u h√¨nh `[ssh]`:\r\n\r\n```ini\r\n[ssh]\r\nenabled  = true\r\nport     = ssh      # N·∫øu b·∫°n ƒë·ªïi port SSH (v√≠ d·ª• 2222), h√£y ƒëi·ªÅn s·ªë 2222 v√†o ƒë√¢y\r\nfilter   = sshd\r\nlogpath  = /var/log/auth.log\r\nmaxretry = 3\r\n```\r\n\r\n### 3. N√¢ng cao: T·ª± t·∫°o b·ªô l·ªçc (Filters) cho Website\r\n\r\nFail2Ban kh√¥ng ch·ªâ b·∫£o v·ªá SSH, n√≥ b·∫£o v·ªá ƒë∆∞·ª£c c·∫£ Nginx, Apache hay th·∫≠m ch√≠ l√† trang ƒëƒÉng nh·∫≠p WordPress c·ªßa b·∫°n.\r\n\r\nNguy√™n l√Ω l√† s·ª≠ d·ª•ng Regex (Bi·ªÉu th·ª©c ch√≠nh quy) ƒë·ªÉ soi log. V√≠ d·ª• b·∫°n mu·ªën ch·∫∑n ai ƒë√≥ c·ªë d√≤ m·∫≠t kh·∫©u trang `wp-login.php`.\r\n\r\n**B∆∞·ªõc 1: Soi log**\r\nXem k·∫ª t·∫•n c√¥ng ƒë·ªÉ l·∫°i d·∫•u v·∫øt g√¨. V√≠ d·ª• trong `/var/log/nginx/access.log`:\r\n`123.123.123.123 ... \"POST /wp-login.php HTTP/1.1\" 200 ...`\r\n\r\n**B∆∞·ªõc 2: Vi·∫øt Regex**\r\nCh√∫ng ta s·∫Ω chuy·ªÉn d√≤ng log tr√™n th√†nh ng√¥n ng·ªØ m√† Fail2Ban hi·ªÉu:\r\n`<HOST> - - \\[(\\d{2})/\\w{3}/\\d{4}:\\1:\\1:\\1 -\\d{4}\\] \"POST /wp-login.php HTTP/1.1\" 200`\r\n\r\n**B∆∞·ªõc 3: T·∫°o filter m·ªõi**\r\nT·∫°o file `/etc/fail2ban/filter.d/wordpress.conf`:\r\n\r\n```ini\r\n[Definition]\r\nfailregex = <HOST> - - \\[(\\d{2})/\\w{3}/\\d{4}:\\1:\\1:\\1 -\\d{4}\\] \"POST /wp-login.php HTTP/1.1\" 200\r\nignoreregex =\r\n```\r\n\r\nSau ƒë√≥ nh·ªõ restart l·∫°i service nh√©:\r\n\r\n```bash\r\nsudo service fail2ban restart\r\n```\r\n\r\n### 4. Qu·∫£n l√Ω v√† Theo d√µi\r\n\r\nC√†i xong r·ªìi th√¨ ph·∫£i bi·∫øt xem n√≥ ƒëang l√†m g√¨ ch·ª© nh·ªâ?\r\n\r\n**Xem Fail2Ban ƒëang \"b·∫Øt\" ƒë∆∞·ª£c bao nhi√™u ƒë·ª©a:**\r\n\r\n```bash\r\nsudo fail2ban-client status\r\n```\r\n\r\n**Xem danh s√°ch IP ƒëang b·ªã ch·∫∑n trong t∆∞·ªùng l·ª≠a:**\r\n\r\n```bash\r\nsudo iptables -L -n -v\r\n```\r\n\r\n### 5. D√†nh cho Pro: C√†i ƒë·∫∑t phi√™n b·∫£n m·ªõi nh·∫•t t·ª´ Source\r\n\r\nƒê√¥i khi kho ·ª©ng d·ª•ng (Repo) c·ªßa Ubuntu/Debian c·∫≠p nh·∫≠t kh√° ch·∫≠m. N·∫øu b·∫°n mu·ªën d√πng c√°c t√≠nh nƒÉng m·ªõi nh·∫•t (nh∆∞ h·ªó tr·ª£ IPv6 t·ªët h∆°n), h√£y c√†i th·ªß c√¥ng.\r\n\r\n**B∆∞·ªõc 1: G·ª° b·∫£n c≈©**\r\n\r\n```bash\r\nsudo apt purge fail2ban\r\n```\r\n\r\n**B∆∞·ªõc 2: T·∫£i v√† c√†i ƒë·∫∑t**\r\nTruy c·∫≠p Github c·ªßa Fail2Ban ƒë·ªÉ l·∫•y link b·∫£n m·ªõi nh·∫•t, sau ƒë√≥:\r\n\r\n```bash\r\n# T·∫£i v·ªÅ v√† gi·∫£i n√©n (v√≠ d·ª• b·∫£n 0.10.4)\r\ntar xvfj fail2ban-0.10.4.tar.bz2\r\ncd fail2ban-0.10.4\r\n\r\n# C√†i ƒë·∫∑t b·∫±ng Python\r\nsudo python setup.py install\r\n```\r\n\r\n**B∆∞·ªõc 3: T·∫°o service kh·ªüi ƒë·ªông c√πng Windows**\r\nV√¨ c√†i th·ªß c√¥ng n√™n b·∫°n ph·∫£i t·ª± copy file kh·ªüi ƒë·ªông (init script):\r\n\r\n```bash\r\ncp files/debian-initd /etc/init.d/fail2ban\r\nupdate-rc.d fail2ban defaults\r\nservice fail2ban start\r\n```\r\n\r\nSau ƒë√≥ ki·ªÉm tra l·∫°i b·∫±ng l·ªánh `fail2ban-client version` l√† xong!"},{"title":"PowerShell Commands for Windows Server Admins","slug":"powershell-command","date":"2025-12-04","tags":["windows","server","automation","bilingual"],"body":"> *üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).*\r\n\r\n---\r\n\r\n### Essential PowerShell \"Lifesaver\" Commands for Windows Server Admins\r\n\r\nHello everyone. Today, I‚Äôd like to share and expand on a list of extremely useful PowerShell commands. Why use PowerShell on Windows Server? Because when you are managing dozens or hundreds of servers, clicking through individual GUI windows is impossible and incredibly slow. PowerShell allows you to operate quickly, accurately, and makes automation easy.\r\n\r\nBelow is a compiled list that includes both basic file operations and advanced system administration commands.\r\n\r\n### 1. File System & Storage Management\r\n\r\n**Calculate folder size instantly**\r\n\r\nOn a Server, right-clicking Properties to check the size of a log folder or user profile can take forever. Use this command to calculate it immediately:\r\n\r\n```powershell\r\n\"{0:N2} GB\" -f ((Get-ChildItem C:\\inetpub\\logs\\ -Recurse | Measure-Object -Property Length -Sum -ErrorAction Stop).Sum / 1GB)\r\n```\r\n\r\n(This command recursively calculates the total size and converts it to GB, which is very handy for checking which folders are consuming your disk space).\r\n\r\n**Search content in files (\"Grep\" for Windows)**\r\n\r\nNeed to find a specific error log or a misconfiguration hidden in dozens of text files? Don‚Äôt open them one by one.\r\n\r\n```powershell\r\nSelect-String -Path C:\\Windows\\System32\\LogFiles\\*.log -Pattern \"Error 500\"\r\n```\r\n\r\n### 2. Service and Process Management\r\n\r\nThis is a daily task for any admin. Instead of opening services.msc or Task Manager, you can do it much faster here.\r\n\r\n**Check and Restart a stuck Service**\r\n\r\nExample: The Web Server (IIS) service is unresponsive.\r\n\r\n```powershell\r\n# Check status\r\nGet-Service -Name W3SVC\r\n\r\n# Restart immediately\r\nRestart-Service -Name W3SVC -Force\r\n```\r\n\r\n**Find and \"Kill\" stubborn processes**\r\n\r\nIs an application eating up too much RAM and refusing to close?\r\n\r\n```powershell\r\n# Find process by name\r\nGet-Process -Name \"notepad\"\r\n\r\n# Force stop the process (Equivalent to End Task)\r\nStop-Process -Name \"notepad\" -Force\r\n```\r\n\r\n### 3. Network & Connectivity Checks\r\n\r\nOn Windows Server, network debugging is critical. The ping command isn't enough because it doesn't check specific ports.\r\n\r\n**Check Ports (Telnet Alternative)**\r\n\r\nThe Test-NetConnection command (alias: tnc) is the most powerful tool to check if your Server can reach a Database or another Web Server.\r\n\r\n```powershell\r\n# Check if the server 192.168.1.10 has port 80 open\r\nTest-NetConnection -ComputerName 192.168.1.10 -Port 80\r\n```\r\n\r\n**View IP information cleanly**\r\n\r\nInstead of ipconfig /all which outputs too much text, this command gives a cleaner view of your Interfaces:\r\n\r\n```powershell\r\nGet-NetIPAddress | Format-Table InterfaceAlias, IPAddress, PrefixLength\r\n```\r\n\r\n### 4. System Event Logs\r\n\r\nReading Event Viewer with the naked eye is exhausting. Filter it using PowerShell instead.\r\n\r\n**Get the 10 most recent system errors**\r\n\r\nThis helps you quickly grasp the server's health status immediately after logging in.\r\n\r\n```powershell\r\nGet-EventLog -LogName System -EntryType Error -Newest 10\r\n```\r\n\r\n### 5. Remote Management\r\n\r\nThis is the \"ultimate weapon\" of Windows Server. You don't need to Remote Desktop (RDP) into a server just to run a few commands.\r\n\r\n**Connect directly to another Server's session**\r\n\r\nThis feature is called PowerShell Remoting (PSSession).\r\n\r\n```powershell\r\n# Open a session to Server01\r\nEnter-PSSession -ComputerName Server01 -Credential (Get-Credential)\r\n```\r\n\r\nAfter running this, your command prompt will change to `[Server01]: PS C:\\>`, meaning every command you type is now running on the remote machine.\r\n\r\n### 6. Updates & Security\r\n\r\n**Check installed HotFixes**\r\n\r\nEssential for verifying if your Server has been patched with the latest security updates.\r\n\r\n```powershell\r\nGet-HotFix | Sort-Object InstalledOn -Descending | Select-Object -First 10\r\n```\r\n\r\n**Run as Admin for a specific application**\r\n\r\nSimilar to the runas command, but this is how you handle it in an object-oriented environment:\r\n\r\n```powershell\r\nStart-Process powershell -Verb RunAs\r\n```\r\n\r\n### Quick Tip: Save as a Script\r\n\r\nIf you frequently run a sequence of commands (e.g., Stop service -> Delete logs -> Start service), save them into a `.ps1` file.\r\n\r\nDon't forget to check the Execution Policy as mentioned in previous posts:\r\n\r\n```powershell\r\nSet-ExecutionPolicy RemoteSigned\r\n```\r\n\r\nI hope this expanded list helps with your system administration tasks. Please comment below if you have any other \"go-to\" commands!\r\n\r\n---\r\n\r\n### T·ªïng h·ª£p c√°c l·ªánh PowerShell \"C·ª©u c√°nh\" cho Qu·∫£n tr·ªã vi√™n Windows Server\r\n\r\nCh√†o m·ªçi ng∆∞·ªùi. H√¥m nay m√¨nh mu·ªën chia s·∫ª v√† m·ªü r·ªông th√™m danh s√°ch c√°c l·ªánh PowerShell c·ª±c k·ª≥ h·ªØu √≠ch. T·∫°i sao l·∫°i l√† PowerShell tr√™n Windows Server? V√¨ khi qu·∫£n l√Ω h√†ng ch·ª•c, h√†ng trƒÉm server, vi·ªác click chu·ªôt qua t·ª´ng c·ª≠a s·ªï GUI l√† b·∫•t kh·∫£ thi v√† ch·∫≠m ch·∫°p. PowerShell gi√∫p b·∫°n thao t√°c nhanh, ch√≠nh x√°c v√† d·ªÖ d√†ng t·ª± ƒë·ªông h√≥a.\r\n\r\nD∆∞·ªõi ƒë√¢y l√† danh s√°ch m√¨nh t·ªïng h·ª£p, bao g·ªìm c·∫£ c√°c thao t√°c file c∆° b·∫£n v√† c√°c l·ªánh qu·∫£n tr·ªã h·ªá th·ªëng n√¢ng cao.\r\n\r\n### 1. Qu·∫£n l√Ω File v√† Dung l∆∞·ª£ng (File System)\r\n\r\n**T√≠nh to√°n k√≠ch th∆∞·ªõc th∆∞ m·ª•c c·ª±c nhanh**\r\n\r\nTr√™n Server, vi·ªác chu·ªôt ph·∫£i ch·ªçn Properties ƒë·ªÉ xem dung l∆∞·ª£ng th∆∞ m·ª•c log ho·∫∑c user profile r·∫•t m·∫•t th·ªùi gian. H√£y d√πng l·ªánh n√†y ƒë·ªÉ t√≠nh to√°n ngay l·∫≠p t·ª©c:\r\n\r\n```powershell\r\n\"{0:N2} GB\" -f ((Get-ChildItem C:\\inetpub\\logs\\ -Recurse | Measure-Object -Property Length -Sum -ErrorAction Stop).Sum / 1GB)\r\n```\r\n\r\n(L·ªánh n√†y ƒë·ªá quy t√≠nh t·ªïng dung l∆∞·ª£ng v√† ƒë·ªïi sang GB, r·∫•t ti·ªán ƒë·ªÉ ki·ªÉm tra th∆∞ m·ª•c n√†o ƒëang chi·∫øm d·ª•ng ·ªï c·ª©ng).\r\n\r\n**T√¨m ki·∫øm n·ªôi dung trong file (Grep cho Windows)**\r\n\r\nB·∫°n c·∫ßn t√¨m m·ªôt d√≤ng log l·ªói c·ª• th·ªÉ ho·∫∑c m·ªôt config sai trong h√†ng t√° file text? ƒê·ª´ng m·ªü t·ª´ng file m·ªôt.\r\n\r\n```powershell\r\nSelect-String -Path C:\\Windows\\System32\\LogFiles\\*.log -Pattern \"Error 500\"\r\n```\r\n\r\n### 2. Qu·∫£n l√Ω D·ªãch v·ª• (Services) v√† Ti·∫øn tr√¨nh (Processes)\r\n\r\nƒê√¢y l√† vi·ªác l√†m h√†ng ng√†y c·ªßa admin. Thay v√¨ m·ªü services.msc hay Task Manager, b·∫°n c√≥ th·ªÉ l√†m nhanh h∆°n nhi·ªÅu.\r\n\r\n**Ki·ªÉm tra v√† Kh·ªüi ƒë·ªông l·∫°i Service b·ªã treo**\r\n\r\nV√≠ d·ª•: Service Web Server (IIS) b·ªã ƒë∆°.\r\n\r\n```powershell\r\n# Ki·ªÉm tra tr·∫°ng th√°i\r\nGet-Service -Name W3SVC\r\n\r\n# Kh·ªüi ƒë·ªông l·∫°i ngay l·∫≠p t·ª©c\r\nRestart-Service -Name W3SVC -Force\r\n```\r\n\r\n**T√¨m v√† \"Kill\" ti·∫øn tr√¨nh c·ª©ng ƒë·∫ßu**\r\n\r\nM·ªôt ·ª©ng d·ª•ng chi·∫øm qu√° nhi·ªÅu RAM v√† kh√¥ng ch·ªãu t·∫Øt?\r\n\r\n```powershell\r\n# T√¨m ti·∫øn tr√¨nh theo t√™n\r\nGet-Process -Name \"notepad\"\r\n\r\n# Bu·ªôc d·ª´ng ti·∫øn tr√¨nh (t∆∞∆°ng ƒë∆∞∆°ng End Task)\r\nStop-Process -Name \"notepad\" -Force\r\n```\r\n\r\n### 3. Ki·ªÉm tra K·∫øt n·ªëi M·∫°ng (Network & Connectivity)\r\n\r\nTr√™n Windows Server, vi·ªác debug m·∫°ng l√† t·ªëi quan tr·ªçng. L·ªánh ping l√† ch∆∞a ƒë·ªß v√¨ n√≥ kh√¥ng ki·ªÉm tra ƒë∆∞·ª£c c·ªïng (port).\r\n\r\n**Ki·ªÉm tra Port (Thay th·∫ø Telnet)**\r\n\r\nL·ªánh Test-NetConnection (hay vi·∫øt t·∫Øt l√† tnc) l√† c√¥ng c·ª• m·∫°nh nh·∫•t ƒë·ªÉ ki·ªÉm tra xem Server c√≥ th√¥ng t·ªõi Database hay Web Server kh√°c kh√¥ng.\r\n\r\n```powershell\r\n# Ki·ªÉm tra xem m√°y ch·ªß 192.168.1.10 c√≥ m·ªü port 80 kh√¥ng\r\nTest-NetConnection -ComputerName 192.168.1.10 -Port 80\r\n```\r\n\r\n**Xem th√¥ng tin IP nhanh g·ªçn**\r\n\r\nThay v√¨ ipconfig /all ra qu√° nhi·ªÅu ch·ªØ, l·ªánh n√†y cho c√°i nh√¨n g·ªçn g√†ng h∆°n v·ªÅ c√°c Interface:\r\n\r\n```powershell\r\nGet-NetIPAddress | Format-Table InterfaceAlias, IPAddress, PrefixLength\r\n```\r\n\r\n### 4. Qu·∫£n l√Ω Nh·∫≠t k√Ω h·ªá th·ªëng (Event Logs)\r\n\r\nƒê·ªçc Event Viewer b·∫±ng m·∫Øt th∆∞·ªùng r·∫•t m·ªèi m·∫Øt. H√£y l·ªçc n√≥ b·∫±ng PowerShell.\r\n\r\n**L·∫•y 10 l·ªói g·∫ßn nh·∫•t trong h·ªá th·ªëng**\r\n\r\nL·ªánh n√†y gi√∫p b·∫°n n·∫Øm b·∫Øt nhanh t√¨nh h√¨nh s·ª©c kh·ªèe c·ªßa Server ngay khi v·ª´a login.\r\n\r\n```powershell\r\nGet-EventLog -LogName System -EntryType Error -Newest 10\r\n```\r\n\r\n### 5. Qu·∫£n tr·ªã t·ª´ xa (Remote Management)\r\n\r\nƒê√¢y l√† \"v≈© kh√≠\" m·∫°nh nh·∫•t c·ªßa Windows Server. B·∫°n kh√¥ng c·∫ßn Remote Desktop (RDP) v√†o server ch·ªâ ƒë·ªÉ ch·∫°y v√†i l·ªánh.\r\n\r\n**K·∫øt n·ªëi tr·ª±c ti·∫øp v√†o phi√™n l√†m vi·ªác c·ªßa Server kh√°c**\r\n\r\nT√≠nh nƒÉng n√†y g·ªçi l√† PowerShell Remoting (PSSession).\r\n\r\n```powershell\r\n# M·ªü m·ªôt phi√™n k·∫øt n·ªëi t·ªõi Server01\r\nEnter-PSSession -ComputerName Server01 -Credential (Get-Credential)\r\n```\r\n\r\nSau khi ch·∫°y l·ªánh n√†y, d·∫•u nh·∫Øc l·ªánh c·ªßa b·∫°n s·∫Ω ƒë·ªïi th√†nh `[Server01]: PS C:\\>`, nghƒ©a l√† m·ªçi l·ªánh b·∫°n g√µ ƒë·ªÅu ƒëang ch·∫°y tr√™n m√°y kia.\r\n\r\n### 6. C·∫≠p nh·∫≠t v√† B·∫£o m·∫≠t\r\n\r\n**Ki·ªÉm tra c√°c b·∫£n v√° l·ªói (HotFix) ƒë√£ c√†i ƒë·∫∑t**\r\n\r\nR·∫•t c·∫ßn thi·∫øt ƒë·ªÉ ki·ªÉm tra xem Server ƒë√£ ƒë∆∞·ª£c patch l·ªó h·ªïng b·∫£o m·∫≠t m·ªõi nh·∫•t ch∆∞a.\r\n\r\n```powershell\r\nGet-HotFix | Sort-Object InstalledOn -Descending | Select-Object -First 10\r\n```\r\n\r\n**Ch·∫°y quy·ªÅn Admin cho m·ªôt ·ª©ng d·ª•ng c·ª• th·ªÉ**\r\n\r\nT∆∞∆°ng t·ª± l·ªánh runas b·∫°n ƒë√£ chia s·∫ª, nh∆∞ng ƒë√¢y l√† c√°ch g·ªçi trong m√¥i tr∆∞·ªùng object:\r\n\r\n```powershell\r\nStart-Process powershell -Verb RunAs\r\n```\r\n\r\n### M·∫πo nh·ªè: L∆∞u l·∫°i th√†nh Script\r\n\r\nN·∫øu b·∫°n th∆∞·ªùng xuy√™n ph·∫£i ch·∫°y m·ªôt chu·ªói c√°c l·ªánh (v√≠ d·ª•: D·ª´ng service -> X√≥a log -> Start service), h√£y l∆∞u ch√∫ng v√†o file `.ps1`.\r\n\r\nƒê·ª´ng qu√™n ki·ªÉm tra Execution Policy nh∆∞ b√†i g·ªëc ƒë√£ ƒë·ªÅ c·∫≠p:\r\n\r\n```powershell\r\nSet-ExecutionPolicy RemoteSigned\r\n```\r\n\r\nHy v·ªçng danh s√°ch m·ªü r·ªông n√†y gi√∫p √≠ch cho c√¥ng vi·ªác qu·∫£n tr·ªã h·ªá th·ªëng c·ªßa b·∫°n. H√£y comment b√™n d∆∞·ªõi n·∫øu b·∫°n c√≥ nh·ªØng l·ªánh \"t·ªß\" n√†o kh√°c nh√©!"},{"title":"PortSentry: Detecting and Blocking Port Scans","slug":"portsentry","date":"2025-12-03","tags":["ubuntu","vps","security","network","bilingual"],"body":"> *üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).*\r\n\r\n---\r\n\r\n### PortSentry: Detecting and Blocking Port Scans\r\nPortSentry is a classic Intrusion Detection System (IDS) specialized in monitoring and preventing port scanning activities on servers. Although active development has ceased, it remains an excellent lesson in active defense mechanisms for anyone working in system security.\r\n\r\nThis article will guide you through cross-platform installation and detailed configuration ranging from basic to \"paranoid.\"\r\n\r\n### 1. Installing PortSentry on Various Distros\r\nDepending on your operating system, choose the appropriate installation method:\r\n\r\n**Debian/Ubuntu/Kali Linux:** Install directly from the official repositories:\r\n\r\n```bash\r\nsudo apt-get update\r\nsudo apt-get install portsentry\r\n```\r\n\r\n**Fedora/CentOS/RHEL:** Typically, you will need to download the RPM package. Then use the command:\r\n\r\n```bash\r\nrpm -i portsentry*\r\n```\r\n(Note: If the RPM package is not found, you may need to compile from source or search within the EPEL repository).\r\n\r\n**Arch Linux:** Use the AUR (Arch User Repository). The old command was `yaourt`, but nowadays you can use `yay` or `paru`:\r\n\r\n```bash\r\nyaourt -S portsentry\r\n# Or\r\nyay -S portsentry\r\n```\r\n\r\n### 2. Configuring Monitoring Tactics\r\nThe main configuration file is located at `/etc/portsentry/portsentry.conf`. We will open it to edit:\r\n\r\n```bash\r\nsudo nano /etc/portsentry/portsentry.conf\r\n```\r\n\r\n#### A. Selecting Port Monitoring Sets (Port Configuration)\r\nPortSentry provides 3 pre-set monitoring levels. You need to uncomment (#) one of the following sets depending on your security \"sensitivity\":\r\n\r\n**Level 1: \"Really Anal\" (Paranoid/Strict)**\r\nSelect this set if you want to monitor almost all sensitive ports. Anyone touching them will be dealt with. This is the recommended choice.\r\n\r\n```bash\r\n# Un-comment these if you are really anal:\r\nTCP_PORTS=\"1,7,9,11,15,70,79,80,109,110,111,119,138,139,143,512,513,514,515,540,635,1080,1524,2000,2001,4000,4001,5742,6000,6001,6667,12345,12346,20034,30303,32771,32772,32773,32774,31337,40421,40425,49724,54320\"\r\nUDP_PORTS=\"1,7,9,66,67,68,69,111,137,138,161,162,474,513,517,518,635,640,641,666,700,2049,32770,32771,32772,32773,32774,31337,54321\"\r\n```\r\n\r\n**Level 2: \"Aware\"**\r\nMonitors common ports, balancing security and performance.\r\n\r\n```bash\r\n# Use these if you just want to be aware:\r\n# TCP_PORTS=\"1,11,15,79,111,119,143,540,635,1080,1524,2000,5742,6667,12345,12346,20034,31337,32771,32772,32773,32774,40421,49724,54320\"\r\n# UDP_PORTS=\"1,7,9,69,161,162,513,635,640,641,700,32770,32771,32772,32773,32774,31337,54321\"\r\n```\r\n\r\n**Level 3: \"Bare-bones\" (Basic)**\r\nMinimal monitoring. Not recommended unless the server is extremely underpowered.\r\n\r\n#### B. Configuring Stealth Scan\r\nIn addition to the ports above, you can configure monitoring for high port ranges (above 1024) to detect stealth scanning techniques.\r\n\r\n```bash\r\nADVANCED_PORTS_TCP=\"1023\"\r\nADVANCED_PORTS_UDP=\"1023\"\r\n```\r\n\r\nCrucially, make sure to exclude ports that you are actually using (e.g., Web, DNS, NetBIOS ports) to avoid blocking valid users:\r\n\r\n```bash\r\nADVANCED_EXCLUDE_TCP=\"113,139\"\r\nADVANCED_EXCLUDE_UDP=\"520,138,137,67\"\r\n```\r\n\r\n### 3. Configuring Response and Blocking\r\nWhat should PortSentry do when an attack is detected?\r\n\r\n**Activate Blocking Mode**\r\nEnsure the following two lines are set to 1 (1 = Block, 0 = Log only, 2 = Run external command):\r\n\r\n```bash\r\nBLOCK_UDP=\"1\"\r\nBLOCK_TCP=\"1\"\r\n```\r\n\r\n**Blocking Method: TCP Wrappers**\r\nA classic but effective blocking method is using `hosts.deny`. When an attacking IP is detected, PortSentry writes that IP to `/etc/hosts.deny`, causing services that support TCP Wrappers (like older SSH configs) to reject connections immediately.\r\n\r\nFind and uncomment this line:\r\n\r\n```bash\r\nKILL_HOSTS_DENY=\"ALL: $TARGET$ : DENY\"\r\n```\r\n(Note: `$TARGET$` is the variable representing the attacker's IP).\r\n\r\n**Log Files and History**\r\nCheck the log file paths to ensure PortSentry records data in the correct location (Note: paths may vary by distro, e.g., `/etc/portsentry/...` or `/usr/pkg/etc/...`):\r\n\r\n```bash\r\n# Hosts to ignore (Whitelist)\r\nIGNORE_FILE=\"/etc/portsentry/portsentry.ignore\"\r\n# Hosts that have been denied (Blocking History)\r\nHISTORY_FILE=\"/etc/portsentry/portsentry.history\"\r\n# Hosts blocked in this session (Current Session)\r\nBLOCKED_FILE=\"/etc/portsentry/portsentry.blocked\"\r\n```\r\n\r\n### 4. Psychological Tactics: Port Banner\r\nYou can leave a message for the attacker if they intentionally connect to trap ports. This is an interesting feature to serve as a warning.\r\n\r\n```bash\r\nPORT_BANNER=\"** UNAUTHORIZED ACCESS PROHIBITED *** YOUR CONNECTION ATTEMPT HAS BEEN LOGGED. GO AWAY.\"\r\n```\r\n\r\n### 5. The Most Important Step: Whitelist (Ignore File)\r\nDo not lock yourself out! Before starting, you absolutely must add your own IP and the local IP to the ignore list.\r\n\r\nOpen the `portsentry.ignore` file (path configured in step 3):\r\n\r\n```bash\r\nsudo nano /etc/portsentry/portsentry.ignore\r\n```\r\n\r\nAdd the following:\r\n\r\n```plaintext\r\n127.0.0.1/32\r\n0.0.0.0\r\n[Your Machine's IP]\r\n[Gateway IP]\r\n```\r\n\r\n### 6. Start and Verify\r\nAfter completion, restart the service:\r\n\r\n```bash\r\nsudo service portsentry restart\r\n```\r\n\r\nTo verify, use another machine to run a simple nmap scan against the server. Then check the `/etc/hosts.deny` file on the server; you should see the attacking machine's IP added to the blacklist along with the warning line.\r\n\r\n### Advanced: Sending Email Alerts When Attacks are Detected\r\nReceiving real-time notifications is a core part of DevSecOps and cybersecurity monitoring.\r\n\r\nBelow is a detailed guide on how to write a simple Shell script to send emails and integrate it into PortSentry's `KILL_RUN_CMD`.\r\n\r\n#### 1. Prepare the Email Environment\r\nTo allow the Linux server to send emails, you need to install the `mailutils` package (on Debian/Ubuntu) or `mailx` (on CentOS).\r\n\r\n**Ubuntu/Debian:**\r\n\r\n```bash\r\nsudo apt-get update\r\nsudo apt-get install mailutils\r\n```\r\n(During installation, if asked to configure Postfix, you can select \"Internet Site\" if the server has a domain, or \"Local only\" for internal testing. However, to send to actual Gmail/Outlook, the server needs SMTP Relay configuration, but let's proceed with creating the script first).\r\n\r\n#### 2. Write the Alert Script (portsentry_alert.sh)\r\nWe will write a script that accepts the Attacker's IP and the Scanned Port as parameters, then composes and sends an email.\r\n\r\nCreate the script file:\r\n\r\n```bash\r\nsudo nano /usr/local/bin/portsentry_alert.sh\r\n```\r\n\r\nPaste the following content:\r\n\r\n```bash\r\n#!/bin/bash\r\n\r\n# ==========================================\r\n# CONFIGURATION\r\n# ==========================================\r\nTO_EMAIL=\"admin@unitrade.id.vn\"  # Replace with your email\r\nSUBJECT=\"[ALERT] PortSentry Detected Attack!\"\r\nSERVER_NAME=$(hostname)\r\nDATE=$(date \"+%Y-%m-%d %H:%M:%S\")\r\n\r\n# Receive parameters from PortSentry\r\nTARGET_IP=$1\r\nTARGET_PORT=$2\r\n\r\n# ==========================================\r\n# EMAIL CONTENT\r\n# ==========================================\r\nBODY=\"\r\nSecurity Alert from Server: $SERVER_NAME\r\n------------------------------------------------\r\nDetection Time      : $DATE\r\nAction Taken        : Blocked\r\nAttacker IP         : $TARGET_IP\r\nScanned Port        : $TARGET_PORT\r\n------------------------------------------------\r\nSystem has automatically added a rule to iptables/hosts.deny.\r\nPlease check logs at /var/log/syslog for more details.\r\n\"\r\n\r\n# ==========================================\r\n# SEND MAIL\r\n# ==========================================\r\necho \"$BODY\" | mail -s \"$SUBJECT\" \"$TO_EMAIL\"\r\n```\r\n\r\nGrant execution permissions to the script:\r\n\r\n```bash\r\nsudo chmod +x /usr/local/bin/portsentry_alert.sh\r\n```\r\n\r\n#### 3. Integrate Script into PortSentry\r\nNow we go back to the PortSentry configuration file to \"teach\" it how to call this script when an attack is detected.\r\n\r\nOpen the config file:\r\n\r\n```bash\r\nsudo nano /etc/portsentry/portsentry.conf\r\n```\r\n\r\nFind the `KILL_RUN_CMD` line. This line allows running an external command before blocking the IP. Edit it as follows:\r\n\r\n```bash\r\n# $TARGET$ is the variable containing the IP, $PORT$ is the variable containing the port\r\nKILL_RUN_CMD=\"/usr/local/bin/portsentry_alert.sh $TARGET$ $PORT$\"\r\n```\r\n\r\n**Important Note:** Ensure `BLOCK_UDP` and `BLOCK_TCP` variables are in mode 1 (Block) or 2 (Run Command Only) for the above command to execute. It is best to leave it at 1 to both block and send the email.\r\n\r\n#### 4. Restart and Test\r\nRestart PortSentry:\r\n\r\n```bash\r\nsudo service portsentry restart\r\n```\r\n\r\n**Attack Simulation:** Use another machine (or a phone using 4G - to have a different IP than the LAN) to scan:\r\n\r\n```bash\r\nnmap -p 1-100 <Your_Server_IP>\r\n```\r\n\r\nIf successful, you will receive an email with the content: `Subject: [ALERT] PortSentry Detected Attack! Body: Security Alert... Attacker IP: 1.2.3.4.`\r\n\r\n-------\r\n\r\n### H∆∞·ªõng d·∫´n to√†n t·∫≠p v·ªÅ PortSentry: Ph√°t hi·ªán v√† Ch·∫∑n ƒë·ª©ng Port Scan\r\nPortSentry l√† m·ªôt c√¥ng c·ª• ph√°t hi·ªán x√¢m nh·∫≠p (IDS) kinh ƒëi·ªÉn, chuy√™n d√πng ƒë·ªÉ gi√°m s√°t v√† ngƒÉn ch·∫∑n c√°c h√†nh vi qu√©t c·ªïng (port scanning) tr√™n m√°y ch·ªß. D√π c√¥ng c·ª• n√†y ƒë√£ ng·ª´ng ph√°t tri·ªÉn, n√≥ v·∫´n l√† m·ªôt b√†i h·ªçc tuy·ªát v·ªùi v·ªÅ c∆° ch·∫ø ph√≤ng th·ªß ch·ªß ƒë·ªông cho b·∫•t k·ª≥ ai l√†m v·ªÅ b·∫£o m·∫≠t h·ªá th·ªëng.\r\n\r\nB√†i vi·∫øt n√†y s·∫Ω h∆∞·ªõng d·∫´n b·∫°n c√†i ƒë·∫∑t tr√™n ƒëa n·ªÅn t·∫£ng v√† c·∫•u h√¨nh chi ti·∫øt t·ª´ c∆° b·∫£n ƒë·∫øn \"paranoid\" (c·ª±c ƒëoan).\r\n\r\n### 1. C√†i ƒë·∫∑t PortSentry tr√™n c√°c Distro\r\nT√πy v√†o h·ªá ƒëi·ªÅu h√†nh b·∫°n ƒëang s·ª≠ d·ª•ng, h√£y ch·ªçn ph∆∞∆°ng ph√°p c√†i ƒë·∫∑t ph√π h·ª£p:\r\n\r\n**Debian/Ubuntu/Kali Linux:** C√†i ƒë·∫∑t tr·ª±c ti·∫øp t·ª´ kho l∆∞u tr·ªØ ch√≠nh th·ª©c:\r\n\r\n```bash\r\nsudo apt-get update\r\nsudo apt-get install portsentry\r\n```\r\n\r\n**Fedora/CentOS/RHEL:** Th√¥ng th∆∞·ªùng b·∫°n s·∫Ω c·∫ßn t·∫£i g√≥i RPM v·ªÅ m√°y. Sau ƒë√≥ s·ª≠ d·ª•ng l·ªánh:\r\n\r\n```bash\r\nrpm -i portsentry*\r\n```\r\n(L∆∞u √Ω: N·∫øu kh√¥ng t√¨m th·∫•y g√≥i RPM, b·∫°n c√≥ th·ªÉ c·∫ßn bi√™n d·ªãch t·ª´ m√£ ngu·ªìn ho·∫∑c t√¨m trong kho EPEL).\r\n\r\n**Arch Linux:** S·ª≠ d·ª•ng AUR (Arch User Repository). L·ªánh c≈© l√† `yaourt`, nh∆∞ng hi·ªán nay b·∫°n c√≥ th·ªÉ d√πng `yay` ho·∫∑c `paru`:\r\n\r\n```bash\r\nyaourt -S portsentry\r\n# Ho·∫∑c\r\nyay -S portsentry\r\n```\r\n\r\n### 2. C·∫•u h√¨nh Chi·∫øn thu·∫≠t Gi√°m s√°t\r\nFile c·∫•u h√¨nh ch√≠nh n·∫±m t·∫°i `/etc/portsentry/portsentry.conf`. Ch√∫ng ta s·∫Ω m·ªü n√≥ l√™n v√† ch·ªânh s·ª≠a:\r\n\r\n```bash\r\nsudo nano /etc/portsentry/portsentry.conf\r\n```\r\n\r\n#### A. L·ª±a ch·ªçn b·ªô c·ªïng gi√°m s√°t (Port Configuration)\r\nPortSentry cung c·∫•p s·∫µn 3 c·∫•p ƒë·ªô gi√°m s√°t. B·∫°n c·∫ßn b·ªè d·∫•u comment (#) ·ªü m·ªôt trong c√°c b·ªô sau t√πy theo m·ª©c ƒë·ªô \"nh·∫°y c·∫£m\" v·ªÅ b·∫£o m·∫≠t c·ªßa b·∫°n:\r\n\r\n**C·∫•p ƒë·ªô 1: \"Really Anal\" (C·ª±c ƒëoan/K·ªπ t√≠nh)**\r\nCh·ªçn b·ªô n√†y n·∫øu b·∫°n mu·ªën gi√°m s√°t g·∫ßn nh∆∞ t·∫•t c·∫£ c√°c c·ªïng nh·∫°y c·∫£m. B·∫•t k·ª≥ ai ch·∫°m v√†o ƒë·ªÅu s·∫Ω b·ªã x·ª≠ l√Ω. ƒê√¢y l√† l·ª±a ch·ªçn t√¥i khuy√™n d√πng.\r\n\r\n```bash\r\n# Un-comment these if you are really anal:\r\nTCP_PORTS=\"1,7,9,11,15,70,79,80,109,110,111,119,138,139,143,512,513,514,515,540,635,1080,1524,2000,2001,4000,4001,5742,6000,6001,6667,12345,12346,20034,30303,32771,32772,32773,32774,31337,40421,40425,49724,54320\"\r\nUDP_PORTS=\"1,7,9,66,67,68,69,111,137,138,161,162,474,513,517,518,635,640,641,666,700,2049,32770,32771,32772,32773,32774,31337,54321\"\r\n```\r\n\r\n**C·∫•p ƒë·ªô 2: \"Aware\" (C·∫£nh gi√°c)**\r\nGi√°m s√°t c√°c c·ªïng ph·ªï bi·∫øn, c√¢n b·∫±ng gi·ªØa b·∫£o m·∫≠t v√† hi·ªáu nƒÉng.\r\n\r\n```bash\r\n# Use these if you just want to be aware:\r\n# TCP_PORTS=\"1,11,15,79,111,119,143,540,635,1080,1524,2000,5742,6667,12345,12346,20034,31337,32771,32772,32773,32774,40421,49724,54320\"\r\n# UDP_PORTS=\"1,7,9,69,161,162,513,635,640,641,700,32770,32771,32772,32773,32774,31337,54321\"\r\n```\r\n\r\n**C·∫•p ƒë·ªô 3: \"Bare-bones\" (C∆° b·∫£n)**\r\nCh·ªâ gi√°m s√°t t·ªëi thi·ªÉu. Kh√¥ng khuy·∫øn kh√≠ch d√πng tr·ª´ khi server qu√° y·∫øu.\r\n\r\n#### B. C·∫•u h√¨nh Stealth Scan (Qu√©t ·∫©n)\r\nNgo√†i c√°c c·ªïng tr√™n, b·∫°n c√≥ th·ªÉ c·∫•u h√¨nh gi√°m s√°t d·∫£i c·ªïng cao (tr√™n 1024) ƒë·ªÉ ph√°t hi·ªán c√°c k·ªπ thu·∫≠t qu√©t l√©n l√∫t.\r\n\r\n```bash\r\nADVANCED_PORTS_TCP=\"1023\"\r\nADVANCED_PORTS_UDP=\"1023\"\r\n```\r\n\r\nƒê·∫∑c bi·ªát, h√£y lo·∫°i tr·ª´ (exclude) c√°c c·ªïng m√† b·∫°n ƒëang th·ª±c s·ª± s·ª≠ d·ª•ng (v√≠ d·ª• c·ªïng Web, DNS, NetBIOS) ƒë·ªÉ tr√°nh ch·∫∑n nh·∫ßm ng∆∞·ªùi d√πng h·ª£p l·ªá:\r\n\r\n```bash\r\nADVANCED_EXCLUDE_TCP=\"113,139\"\r\nADVANCED_EXCLUDE_UDP=\"520,138,137,67\"\r\n```\r\n\r\n### 3. C·∫•u h√¨nh Ph·∫£n ·ª©ng v√† Ch·∫∑n (Blocking)\r\nKhi ph√°t hi·ªán t·∫•n c√¥ng, PortSentry s·∫Ω l√†m g√¨?\r\n\r\n**K√≠ch ho·∫°t ch·∫ø ƒë·ªô ch·∫∑n**\r\nƒê·∫£m b·∫£o hai d√≤ng sau ƒë∆∞·ª£c ƒë·∫∑t gi√° tr·ªã 1 (1 = Ch·∫∑n, 0 = Ch·ªâ ghi log, 2 = Ch·∫°y l·ªánh ngo√†i):\r\n\r\n```bash\r\nBLOCK_UDP=\"1\"\r\nBLOCK_TCP=\"1\"\r\n```\r\n\r\n**Ph∆∞∆°ng ph√°p ch·∫∑n: TCP Wrappers**\r\nM·ªôt ph∆∞∆°ng ph√°p ch·∫∑n c·ªï ƒëi·ªÉn nh∆∞ng hi·ªáu qu·∫£ l√† s·ª≠ d·ª•ng `hosts.deny`. Khi ph√°t hi·ªán IP t·∫•n c√¥ng, PortSentry s·∫Ω ghi IP ƒë√≥ v√†o file `/etc/hosts.deny`, l√†m cho c√°c d·ªãch v·ª• h·ªó tr·ª£ TCP Wrappers (nh∆∞ SSH c≈©) t·ª´ ch·ªëi k·∫øt n·ªëi ngay l·∫≠p t·ª©c.\r\n\r\nT√¨m v√† b·ªè comment d√≤ng n√†y:\r\n\r\n```bash\r\nKILL_HOSTS_DENY=\"ALL: $TARGET$ : DENY\"\r\n```\r\n(L∆∞u √Ω: `$TARGET$` l√† bi·∫øn ƒë·∫°i di·ªán cho IP c·ªßa k·∫ª t·∫•n c√¥ng).\r\n\r\n**File Log v√† L·ªãch s·ª≠**\r\nKi·ªÉm tra ƒë∆∞·ªùng d·∫´n file log ƒë·ªÉ ƒë·∫£m b·∫£o PortSentry ghi d·ªØ li·ªáu ƒë√∫ng ch·ªó (L∆∞u √Ω ƒë∆∞·ªùng d·∫´n c√≥ th·ªÉ kh√°c nhau t√πy distro, v√≠ d·ª• `/etc/portsentry/...` ho·∫∑c `/usr/pkg/etc/...`):\r\n\r\n```bash\r\n# Hosts to ignore (Danh s√°ch tr·∫Øng)\r\nIGNORE_FILE=\"/etc/portsentry/portsentry.ignore\"\r\n# Hosts that have been denied (L·ªãch s·ª≠ ch·∫∑n)\r\nHISTORY_FILE=\"/etc/portsentry/portsentry.history\"\r\n# Hosts blocked in this session (Phi√™n hi·ªán t·∫°i)\r\nBLOCKED_FILE=\"/etc/portsentry/portsentry.blocked\"\r\n```\r\n\r\n### 4. \"ƒê√≤n t√¢m l√Ω\": Port Banner\r\nB·∫°n c√≥ th·ªÉ ƒë·ªÉ l·∫°i m·ªôt l·ªùi nh·∫Øn cho k·∫ª t·∫•n c√¥ng n·∫øu ch√∫ng c·ªë t√¨nh k·∫øt n·ªëi v√†o c√°c c·ªïng b·∫´y. ƒê√¢y l√† m·ªôt t√≠nh nƒÉng th√∫ v·ªã ƒë·ªÉ c·∫£nh b√°o.\r\n\r\n```bash\r\nPORT_BANNER=\"** UNAUTHORIZED ACCESS PROHIBITED *** YOUR CONNECTION ATTEMPT HAS BEEN LOGGED. GO AWAY.\"\r\n```\r\n\r\n### 5. B∆∞·ªõc quan tr·ªçng nh·∫•t: Whitelist (Ignore File)\r\nƒê·ª´ng t·ª± nh·ªët m√¨nh ·ªü ngo√†i! Tr∆∞·ªõc khi kh·ªüi ƒë·ªông, b·∫°n b·∫Øt bu·ªôc ph·∫£i th√™m IP c·ªßa ch√≠nh m√¨nh v√† IP local v√†o danh s√°ch b·ªè qua.\r\n\r\nM·ªü file `portsentry.ignore` (ƒë∆∞·ªùng d·∫´n ƒë√£ c·∫•u h√¨nh ·ªü b∆∞·ªõc 3):\r\n\r\n```bash\r\nsudo nano /etc/portsentry/portsentry.ignore\r\n```\r\n\r\nTh√™m v√†o:\r\n\r\n```plaintext\r\n127.0.0.1/32\r\n0.0.0.0\r\n[IP C·ªßa M√°y B·∫°n]\r\n[IP Gateway]\r\n```\r\n\r\n### 6. Kh·ªüi ƒë·ªông v√† Ki·ªÉm tra\r\nSau khi ho√†n t·∫•t, kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª•:\r\n\r\n```bash\r\nsudo service portsentry restart\r\n```\r\n\r\nƒê·ªÉ ki·ªÉm tra, h√£y d√πng m·ªôt m√°y kh√°c th·ª±c hi·ªán l·ªánh nmap ƒë∆°n gi·∫£n v√†o server. Sau ƒë√≥ ki·ªÉm tra file `/etc/hosts.deny` tr√™n server, b·∫°n s·∫Ω th·∫•y IP c·ªßa m√°y t·∫•n c√¥ng ƒë√£ b·ªã th√™m v√†o danh s√°ch ƒëen k√®m theo d√≤ng c·∫£nh b√°o.\r\n\r\n### N√¢ng cao: G·ª≠i Email C·∫£nh B√°o Khi Ph√°t Hi·ªán T·∫•n C√¥ng v·ªõi PortSentry\r\nVi·ªác nh·∫≠n th√¥ng b√°o ngay l·∫≠p t·ª©c (Real-time Notification) l√† m·ªôt ph·∫ßn c·ªët l√µi c·ªßa DevSecOps v√† gi√°m s√°t an ninh m·∫°ng.\r\n\r\nD∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n chi ti·∫øt c√°ch vi·∫øt m·ªôt script Shell ƒë∆°n gi·∫£n ƒë·ªÉ g·ª≠i email v√† t√≠ch h·ª£p n√≥ v√†o `KILL_RUN_CMD` c·ªßa PortSentry.\r\n\r\n#### 1. Chu·∫©n b·ªã m√¥i tr∆∞·ªùng g·ª≠i mail\r\nƒê·ªÉ server Linux g·ª≠i ƒë∆∞·ª£c email, b·∫°n c·∫ßn c√†i ƒë·∫∑t g√≥i `mailutils` (tr√™n Debian/Ubuntu) ho·∫∑c `mailx` (tr√™n CentOS).\r\n\r\n**Ubuntu/Debian:**\r\n\r\n```bash\r\nsudo apt-get update\r\nsudo apt-get install mailutils\r\n```\r\n(Trong qu√° tr√¨nh c√†i ƒë·∫∑t, n·∫øu n√≥ h·ªèi c·∫•u h√¨nh Postfix, b·∫°n c√≥ th·ªÉ ch·ªçn \"Internet Site\" n·∫øu server c√≥ domain, ho·∫∑c \"Local only\" n·∫øu ch·ªâ test n·ªôi b·ªô. Tuy nhi√™n, ƒë·ªÉ g·ª≠i ra Gmail/Outlook th·ª±c t·∫ø, server c·∫ßn c·∫•u h√¨nh SMTP Relay, nh∆∞ng ta c·ª© ƒëi qua b∆∞·ªõc t·∫°o script tr∆∞·ªõc).\r\n\r\n#### 2. Vi·∫øt Script C·∫£nh B√°o (portsentry_alert.sh)\r\nCh√∫ng ta s·∫Ω vi·∫øt m·ªôt script nh·∫≠n tham s·ªë l√† IP k·∫ª t·∫•n c√¥ng v√† C·ªïng b·ªã qu√©t, sau ƒë√≥ so·∫°n n·ªôi dung v√† g·ª≠i mail.\r\n\r\nT·∫°o file script:\r\n\r\n```bash\r\nsudo nano /usr/local/bin/portsentry_alert.sh\r\n```\r\n\r\nD√°n n·ªôi dung sau v√†o:\r\n\r\n```bash\r\n#!/bin/bash\r\n\r\n# ==========================================\r\n# C·∫§U H√åNH\r\n# ==========================================\r\nTO_EMAIL=\"admin@unitrade.id.vn\"  # Thay b·∫±ng email c·ªßa b·∫°n\r\nSUBJECT=\"[ALERT] PortSentry Detected Attack!\"\r\nSERVER_NAME=$(hostname)\r\nDATE=$(date \"+%Y-%m-%d %H:%M:%S\")\r\n\r\n# Nh·∫≠n tham s·ªë t·ª´ PortSentry\r\nTARGET_IP=$1\r\nTARGET_PORT=$2\r\n\r\n# ==========================================\r\n# N·ªòI DUNG EMAIL\r\n# ==========================================\r\nBODY=\"\r\nC·∫£nh b√°o b·∫£o m·∫≠t t·ª´ Server: $SERVER_NAME\r\n------------------------------------------------\r\nTh·ªùi gian ph√°t hi·ªán : $DATE\r\nH√†nh ƒë·ªông           : ƒê√£ ch·∫∑n (Blocked)\r\nIP K·∫ª t·∫•n c√¥ng      : $TARGET_IP\r\nC·ªïng b·ªã qu√©t        : $TARGET_PORT\r\n------------------------------------------------\r\nH·ªá th·ªëng ƒë√£ t·ª± ƒë·ªông th√™m rule v√†o iptables/hosts.deny.\r\nVui l√≤ng ki·ªÉm tra log t·∫°i /var/log/syslog ƒë·ªÉ bi·∫øt th√™m chi ti·∫øt.\r\n\"\r\n\r\n# ==========================================\r\n# G·ª¨I MAIL\r\n# ==========================================\r\necho \"$BODY\" | mail -s \"$SUBJECT\" \"$TO_EMAIL\"\r\n```\r\n\r\nC·∫•p quy·ªÅn th·ª±c thi cho script:\r\n\r\n```bash\r\nsudo chmod +x /usr/local/bin/portsentry_alert.sh\r\n```\r\n\r\n#### 3. T√≠ch h·ª£p Script v√†o PortSentry\r\nB√¢y gi·ªù ch√∫ng ta quay l·∫°i file c·∫•u h√¨nh c·ªßa PortSentry ƒë·ªÉ \"d·∫°y\" n√≥ c√°ch g·ªçi script n√†y khi ph√°t hi·ªán t·∫•n c√¥ng.\r\n\r\nM·ªü file config:\r\n\r\n```bash\r\nsudo nano /etc/portsentry/portsentry.conf\r\n```\r\n\r\nT√¨m d√≤ng `KILL_RUN_CMD`. D√≤ng n√†y cho ph√©p ch·∫°y m·ªôt l·ªánh ngo√†i (external command) tr∆∞·ªõc khi ch·∫∑n IP. S·ª≠a l·∫°i nh∆∞ sau:\r\n\r\n```bash\r\n# $TARGET$ l√† bi·∫øn ch·ª©a IP, $PORT$ l√† bi·∫øn ch·ª©a c·ªïng\r\nKILL_RUN_CMD=\"/usr/local/bin/portsentry_alert.sh $TARGET$ $PORT$\"\r\n```\r\n\r\nL∆∞u √Ω quan tr·ªçng: ƒê·∫£m b·∫£o bi·∫øn `BLOCK_UDP` v√† `BLOCK_TCP` ·ªü ch·∫ø ƒë·ªô 1 (Block) ho·∫∑c 2 (Run Command Only) th√¨ l·ªánh tr√™n m·ªõi ƒë∆∞·ª£c th·ª±c thi. T·ªët nh·∫•t l√† ƒë·ªÉ 1 ƒë·ªÉ v·ª´a ch·∫∑n v·ª´a g·ª≠i mail.\r\n\r\n#### 4. Kh·ªüi ƒë·ªông l·∫°i v√† Test\r\nRestart PortSentry:\r\n\r\n```bash\r\nsudo service portsentry restart\r\n```\r\n\r\nTh·ª≠ nghi·ªám (Attack Simulation): S·ª≠ d·ª•ng m√°y kh√°c (ho·∫∑c ƒëi·ªán tho·∫°i d√πng 4G - ƒë·ªÉ kh√°c IP m·∫°ng Lan) qu√©t th·ª≠:\r\n\r\n```bash\r\nnmap -p 1-100 <IP_Server_Cua_Ban>\r\n```\r\n\r\nN·∫øu th√†nh c√¥ng, b·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c m·ªôt email v·ªõi n·ªôi dung:\r\n`Subject: [ALERT] PortSentry Detected Attack! Body: C·∫£nh b√°o b·∫£o m·∫≠t... IP K·∫ª t·∫•n c√¥ng: 1.2.3.4.`"},{"title":"Mastering Linux Firewalls UFW (Uncomplicated Firewall)","slug":"ufw","date":"2025-12-02","tags":["ubuntu","vps","bilingual","cybersecurity","firewall","ufw","iptables"],"body":"> *üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).*\r\n\r\n---\r\n\r\n### Mastering Linux Firewalls Made Easy with UFW (Uncomplicated Firewall)\r\n\r\nHello everyone! If you've ever had a headache looking at the messy rules of iptables to configure a firewall, then UFW is your savior.\r\n\r\nTrue to its name, \"Uncomplicated Firewall\", this tool was born to simplify server protection. It provides an extremely friendly command-line interface to manage the underlying iptables. Today, I will guide you through the essential operations to master UFW.\r\n\r\n### 1. Installation and Startup\r\n\r\nOn distros like Ubuntu or Debian, installation takes just a few seconds:\r\n\r\n```bash\r\nsudo apt install ufw\r\n```\r\n\r\nBy default after installation, UFW will be Inactive to prevent locking you out of the server immediately. To check the status:\r\n\r\n```bash\r\nsudo ufw status\r\n```\r\n\r\nIf you want to support IPv6, open the configuration file and check this line:\r\n\r\n```bash\r\nsudo nano /etc/default/ufw\r\n# Ensure this line is set to yes\r\nIPV6=yes\r\n```\r\n\r\nIf you need to restart the firewall after changing the config:\r\n\r\n```bash\r\nsudo ufw disable\r\nsudo ufw enable\r\n```\r\n\r\n### 2. Setting Default \"Rules of the Game\"\r\n\r\nThe golden rule in security is: \"Deny all, allow only what is necessary\". Before opening any ports, set the defaults to block all incoming connections and allow all outgoing connections.\r\n\r\n```bash\r\n# Block all incoming traffic\r\nsudo ufw default deny incoming\r\n\r\n# Allow all outgoing traffic\r\nsudo ufw default allow outgoing\r\n```\r\n\r\n**Quick Tip:** To ensure UFW always starts with the system, check the `/etc/ufw/ufw.conf` file and set `ENABLED=yes`.\r\n\r\n### 3. Opening Ports (Allow)\r\n\r\n**Most Important: SSH**\r\nNever enable the firewall without opening the SSH port, otherwise, you will lock yourself out!\r\n\r\n```bash\r\n# Method 1: By service name\r\nsudo ufw allow ssh\r\n\r\n# Method 2: By port number (default is 22)\r\nsudo ufw allow 22/tcp\r\n```\r\n\r\n*Note: If you changed your SSH port to a different number (e.g., 2222), use the command: `sudo ufw allow 2222/tcp`.*\r\n\r\n**Web Server (HTTP/HTTPS)**\r\nAllow web access:\r\n\r\n```bash\r\nsudo ufw allow www\r\n# Or\r\nsudo ufw allow 80/tcp\r\n```\r\n\r\n**FTP Server**\r\n\r\n```bash\r\nsudo ufw allow ftp\r\n# Or\r\nsudo ufw allow 21/tcp\r\n```\r\n\r\n**Opening a Port Range**\r\nIf your application needs a wide range of ports (e.g., from 100 to 300):\r\n\r\n```bash\r\nsudo ufw allow 100:300/tcp\r\nsudo ufw allow 100:300/udp\r\n```\r\n\r\n### 4. Advanced Configuration (Specific IP)\r\n\r\nThis is a great way to enhance security. Instead of opening the door to the whole world, you only open it for a specific person.\r\n\r\n**Allow a specific IP:**\r\n\r\n```bash\r\nsudo ufw allow from 192.168.0.100\r\n```\r\n\r\n**Allow an entire Subnet:**\r\n\r\n```bash\r\nsudo ufw allow from 123.45.67.89/24\r\n```\r\n\r\n**Combo: Allow this IP to this specific Port only:**\r\nExample: Only allow the Boss's machine (IP 123.45.67.89) to SSH into the server.\r\n\r\n```bash\r\nsudo ufw allow from 123.45.67.89 to any port 22 proto tcp\r\n```\r\n\r\n### 5. Managing and Deleting Rules\r\n\r\nAdded a rule by mistake? No problem.\r\n\r\n**Block connections (Deny)**\r\nAlthough we defaulted to deny all, if you need to specifically block a port that is currently open:\r\n\r\n```bash\r\nsudo ufw deny 80/tcp\r\n```\r\n\r\n**Delete rules (Delete)**\r\nThe simplest way is to add delete before the old command:\r\n\r\n```bash\r\nsudo ufw delete allow 80/tcp\r\n```\r\n\r\n**The \"Pro\" way to delete (by line number)**\r\nSometimes you don't remember the original command, so list them with numbers:\r\n\r\n```bash\r\nsudo ufw status numbered\r\n```\r\n\r\nThe result will look like `[ 1] 22/tcp ALLOW ....` To delete rule number 1, just run:\r\n\r\n```bash\r\nsudo ufw delete 1\r\n```\r\n\r\n### 6. Operation\r\n\r\nOnce you have finished configuring the rules, it's time to turn the firewall ON:\r\n\r\n```bash\r\nsudo ufw enable\r\n```\r\n\r\nTo see detailed running rules:\r\n\r\n```bash\r\nsudo ufw status verbose\r\n```\r\n\r\nIf you messed up the configuration too much and want to start over (Reset):\r\n\r\n```bash\r\nsudo ufw reset\r\n```\r\n\r\n### 7. System Logging\r\n\r\nTo know who is trying to \"intrude\" or to check if rules are working correctly, enable logging:\r\n\r\n```bash\r\nsudo ufw logging on\r\n# Set log level (low, medium, high). Default is low.\r\nsudo ufw logging medium\r\n```\r\n\r\nRead logs at `/var/log/ufw.log` or via `dmesg`. A log line will look like this: `[UFW BLOCK] IN=eth0 ... SRC=123.45.67.89 DST=987.65.43.21 ... DPT=22`\r\n\r\n**Quick Decode:**\r\n\r\n*   `[UFW BLOCK]`: Connection has been blocked.\r\n*   `SRC`: The IP address of the source sending the packet.\r\n*   `DPT` (Destination Port): The port they are trying to access (e.g., 22 is SSH).\r\n\r\n**Bonus: For the team that hates typing commands**\r\nIf you prefer a Graphical User Interface (GUI), install GUFW:\r\n\r\n```bash\r\nsudo apt install gufw\r\n```\r\n\r\nIt provides an intuitive interface to toggle the firewall with just a few clicks.\r\n\r\nHope this article helps you manage your server safely and easily. If you have any questions, feel free to comment below!\r\n\r\n---\r\n\r\n### L√†m ch·ªß t∆∞·ªùng l·ª≠a tr√™n Linux c·ª±c d·ªÖ v·ªõi UFW (Uncomplicated Firewall)\r\n\r\nCh√†o m·ªçi ng∆∞·ªùi! N·∫øu b·∫°n t·ª´ng \"ƒëau ƒë·∫ßu\" khi nh√¨n v√†o m·ªõ quy t·∫Øc r·ªëi r·∫Øm c·ªßa iptables ƒë·ªÉ c·∫•u h√¨nh t∆∞·ªùng l·ª≠a, th√¨ UFW ch√≠nh l√† v·ªã c·ª©u tinh c·ªßa b·∫°n.\r\n\r\nƒê√∫ng nh∆∞ t√™n g·ªçi \"Uncomplicated Firewall\" (T∆∞·ªùng l·ª≠a kh√¥ng ph·ª©c t·∫°p), c√¥ng c·ª• n√†y sinh ra ƒë·ªÉ ƒë∆°n gi·∫£n h√≥a vi·ªác b·∫£o v·ªá server. N√≥ cung c·∫•p m·ªôt giao di·ªán d√≤ng l·ªánh c·ª±c k·ª≥ th√¢n thi·ªán ƒë·ªÉ qu·∫£n l√Ω iptables b√™n d∆∞·ªõi. H√¥m nay m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n nh·ªØng thao t√°c \"n·∫±m l√≤ng\" ƒë·ªÉ s·ª≠ d·ª•ng UFW nh√©.\r\n\r\n### 1. C√†i ƒë·∫∑t v√† Kh·ªüi ƒë·ªông\r\n\r\nTr√™n c√°c distro nh∆∞ Ubuntu hay Debian, vi·ªác c√†i ƒë·∫∑t ch·ªâ t·ªën v√†i gi√¢y:\r\n\r\n```bash\r\nsudo apt install ufw\r\n```\r\n\r\nM·∫∑c ƒë·ªãnh sau khi c√†i, UFW s·∫Ω ·ªü tr·∫°ng th√°i Inactive (kh√¥ng ho·∫°t ƒë·ªông) ƒë·ªÉ tr√°nh vi·ªác b·∫°n v·ª´a c√†i xong ƒë√£ b·ªã ch·∫∑n kh·ªèi server. ƒê·ªÉ ki·ªÉm tra tr·∫°ng th√°i:\r\n\r\n```bash\r\nsudo ufw status\r\n```\r\n\r\nN·∫øu b·∫°n mu·ªën h·ªó tr·ª£ c·∫£ IPv6, h√£y m·ªü file c·∫•u h√¨nh v√† ki·ªÉm tra d√≤ng n√†y:\r\n\r\n```bash\r\nsudo nano /etc/default/ufw\r\n# ƒê·∫£m b·∫£o d√≤ng n√†y l√† yes\r\nIPV6=yes\r\n```\r\n\r\nN·∫øu b·∫°n c·∫ßn kh·ªüi ƒë·ªông l·∫°i t∆∞·ªùng l·ª≠a sau khi ch·ªânh config:\r\n\r\n```bash\r\nsudo ufw disable\r\nsudo ufw enable\r\n```\r\n\r\n### 2. Thi·∫øt l·∫≠p \"Lu·∫≠t ch∆°i\" m·∫∑c ƒë·ªãnh (Defaults)\r\n\r\nNguy√™n t·∫Øc v√†ng trong b·∫£o m·∫≠t l√†: \"C·∫•m t·∫•t c·∫£, ch·ªâ m·ªü nh·ªØng g√¨ c·∫ßn thi·∫øt\". Tr∆∞·ªõc khi m·ªü c·ªïng, h√£y thi·∫øt l·∫≠p m·∫∑c ƒë·ªãnh ch·∫∑n m·ªçi k·∫øt n·ªëi t·ª´ ngo√†i v√†o (incoming) v√† cho ph√©p m·ªçi k·∫øt n·ªëi t·ª´ trong ra (outgoing).\r\n\r\n```bash\r\n# Ch·∫∑n t·∫•t c·∫£ chi·ªÅu v√†o\r\nsudo ufw default deny incoming\r\n\r\n# Cho ph√©p t·∫•t c·∫£ chi·ªÅu ra\r\nsudo ufw default allow outgoing\r\n```\r\n\r\n**M·∫πo nh·ªè:** ƒê·ªÉ UFW lu√¥n t·ª± b·∫≠t khi kh·ªüi ƒë·ªông m√°y, h√£y ki·ªÉm tra file `/etc/ufw/ufw.conf` v√† set `ENABLED=yes`.\r\n\r\n### 3. M·ªü c·ªïng k·∫øt n·ªëi (Allow)\r\n\r\n**Quan tr·ªçng nh·∫•t: SSH**\r\nƒê·ª´ng bao gi·ªù b·∫≠t t∆∞·ªùng l·ª≠a m√† qu√™n m·ªü c·ªïng SSH, n·∫øu kh√¥ng b·∫°n s·∫Ω t·ª± nh·ªët m√¨nh ·ªü ngo√†i ƒë·∫•y!\r\n\r\n```bash\r\n# C√°ch 1: G·ªçi t√™n d·ªãch v·ª•\r\nsudo ufw allow ssh\r\n\r\n# C√°ch 2: G·ªçi s·ªë port (m·∫∑c ƒë·ªãnh l√† 22)\r\nsudo ufw allow 22/tcp\r\n```\r\n\r\n*L∆∞u √Ω: N·∫øu b·∫°n ƒë√£ ƒë·ªïi port SSH sang s·ªë kh√°c (v√≠ d·ª• 2222), h√£y d√πng l·ªánh: `sudo ufw allow 2222/tcp`.*\r\n\r\n**Web Server (HTTP/HTTPS)**\r\nCho ph√©p truy c·∫≠p web:\r\n\r\n```bash\r\nsudo ufw allow www\r\n# Ho·∫∑c\r\nsudo ufw allow 80/tcp\r\n```\r\n\r\n**FTP Server**\r\n\r\n```bash\r\nsudo ufw allow ftp\r\n# Ho·∫∑c\r\nsudo ufw allow 21/tcp\r\n```\r\n\r\n**M·ªü m·ªôt d·∫£i Port**\r\nN·∫øu ·ª©ng d·ª•ng c·ªßa b·∫°n c·∫ßn m·ªôt d·∫£i c·ªïng r·ªông (v√≠ d·ª• t·ª´ 100 ƒë·∫øn 300):\r\n\r\n```bash\r\nsudo ufw allow 100:300/tcp\r\nsudo ufw allow 100:300/udp\r\n```\r\n\r\n### 4. C·∫•u h√¨nh n√¢ng cao (Specific IP)\r\n\r\nƒê√¢y l√† c√°ch tuy·ªát v·ªùi ƒë·ªÉ tƒÉng c∆∞·ªùng b·∫£o m·∫≠t. Thay v√¨ m·ªü c·ª≠a cho c·∫£ th·∫ø gi·ªõi, b·∫°n ch·ªâ m·ªü c·ª≠a cho m·ªôt ng∆∞·ªùi c·ª• th·ªÉ.\r\n\r\n**Cho ph√©p 1 IP c·ª• th·ªÉ:**\r\n\r\n```bash\r\nsudo ufw allow from 192.168.0.100\r\n```\r\n\r\n**Cho ph√©p c·∫£ m·ªôt Subnet (M·∫°ng con):**\r\n\r\n```bash\r\nsudo ufw allow from 123.45.67.89/24\r\n```\r\n\r\n**Combo: Ch·ªâ cho ph√©p IP n√†y v√†o Port n√†y:**\r\nV√≠ d·ª•: Ch·ªâ cho m√°y S·∫øp (IP 123.45.67.89) ƒë∆∞·ª£c SSH v√†o server.\r\n\r\n```bash\r\nsudo ufw allow from 123.45.67.89 to any port 22 proto tcp\r\n```\r\n\r\n### 5. Qu·∫£n l√Ω v√† X√≥a quy t·∫Øc\r\n\r\nL·ª° tay th√™m nh·∫ßm lu·∫≠t? Kh√¥ng sao c·∫£.\r\n\r\n**Ch·∫∑n k·∫øt n·ªëi (Deny)**\r\nM·∫∑c d√π m·∫∑c ƒë·ªãnh ch√∫ng ta ƒë√£ ch·∫∑n h·∫øt, nh∆∞ng n·∫øu c·∫ßn ch·∫∑n c·ª• th·ªÉ m·ªôt port n√†o ƒë√≥ ƒëang m·ªü:\r\n\r\n```bash\r\nsudo ufw deny 80/tcp\r\n```\r\n\r\n**X√≥a quy t·∫Øc (Delete)**\r\nC√°ch ƒë∆°n gi·∫£n nh·∫•t l√† th√™m t·ª´ delete v√†o tr∆∞·ªõc c√¢u l·ªánh c≈©:\r\n\r\n```bash\r\nsudo ufw delete allow 80/tcp\r\n```\r\n\r\n**C√°ch x√≥a chuy√™n nghi·ªáp h∆°n (theo s·ªë th·ª© t·ª±)**\r\nƒê√¥i khi b·∫°n kh√¥ng nh·ªõ c√¢u l·ªánh g·ªëc, h√£y li·ªát k√™ ch√∫ng ra k√®m s·ªë th·ª© t·ª±:\r\n\r\n```bash\r\nsudo ufw status numbered\r\n```\r\n\r\nK·∫øt qu·∫£ s·∫Ω c√≥ d·∫°ng `[ 1] 22/tcp ALLOW ....` Mu·ªën x√≥a quy t·∫Øc s·ªë 1, ch·ªâ c·∫ßn:\r\n\r\n```bash\r\nsudo ufw delete 1\r\n```\r\n\r\n### 6. V·∫≠n h√†nh\r\n\r\nSau khi ƒë√£ c·∫•u h√¨nh xong xu√¥i c√°c quy t·∫Øc, gi·ªù l√† l√∫c B·∫¨T t∆∞·ªùng l·ª≠a l√™n:\r\n\r\n```bash\r\nsudo ufw enable\r\n```\r\n\r\nƒê·ªÉ xem chi ti·∫øt c√°c quy t·∫Øc ƒëang ch·∫°y:\r\n\r\n```bash\r\nsudo ufw status verbose\r\n```\r\n\r\nN·∫øu b·∫°n c·∫•u h√¨nh sai qu√° nhi·ªÅu v√† mu·ªën l√†m l·∫°i t·ª´ ƒë·∫ßu (Reset):\r\n\r\n```bash\r\nsudo ufw reset\r\n```\r\n\r\n### 7. Nh·∫≠t k√Ω h·ªá th·ªëng (Logging)\r\n\r\nƒê·ªÉ bi·∫øt ai ƒëang c·ªë g·∫Øng \"ƒë·ªôt nh·∫≠p\" ho·∫∑c ki·ªÉm tra xem rule c√≥ ch·∫°y ƒë√∫ng kh√¥ng, h√£y b·∫≠t log:\r\n\r\n```bash\r\nsudo ufw logging on\r\n# Ch·ªânh m·ª©c ƒë·ªô log (low, medium, high). M·∫∑c ƒë·ªãnh l√† low.\r\nsudo ufw logging medium\r\n```\r\n\r\nƒê·ªçc log t·∫°i `/var/log/ufw.log` ho·∫∑c `dmesg`. M·ªôt d√≤ng log s·∫Ω tr√¥ng nh∆∞ th·∫ø n√†y: `[UFW BLOCK] IN=eth0 ... SRC=123.45.67.89 DST=987.65.43.21 ... DPT=22`\r\n\r\n**Gi·∫£i m√£ nhanh:**\r\n\r\n*   `[UFW BLOCK]`: K·∫øt n·ªëi ƒë√£ b·ªã ch·∫∑n.\r\n*   `SRC`: IP c·ªßa k·∫ª ƒëang g·ª≠i g√≥i tin ƒë·∫øn.\r\n*   `DPT` (Destination Port): C·ªïng m√† h·ªç ƒëang c·ªë truy c·∫≠p (v√≠ d·ª• 22 l√† SSH).\r\n\r\n**Bonus: D√†nh cho team kh√¥ng th√≠ch g√µ l·ªánh**\r\nN·∫øu b·∫°n th√≠ch giao di·ªán ƒë·ªì h·ªça (GUI), h√£y c√†i ƒë·∫∑t GUFW:\r\n\r\n```bash\r\nsudo apt install gufw\r\n```\r\n\r\nN√≥ cung c·∫•p m·ªôt giao di·ªán tr·ª±c quan ƒë·ªÉ b·∫°n b·∫≠t t·∫Øt firewall ch·ªâ b·∫±ng nh·ªØng c√∫ click chu·ªôt.\r\n"},{"title":"Road to DevOps #1 | Web server with Nginx and Log monitoring with GoAccess","slug":"road-to-devops-1","date":"2025-12-01","tags":["cybersecurity","personal","bilingual"],"body":"> *üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).*\r\n\r\n\r\n\r\nAlo alo alo"},{"title":"A Friendly Guide to Setting Up a Fresh Ubuntu Server","slug":"ultimate-script-for-linuxsetup","date":"2025-12-01","tags":["ubuntu","vps","automation","docker","bilingual"],"body":"> *üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).*\r\n\r\n---\r\n\r\n### The \"I Forgot to Install Git Again\" Solution\r\n\r\nHey everyone!\r\n\r\nWe‚Äôve all been there. You just spun up a fresh Ubuntu VPS or a new Virtual Machine. You‚Äôre excited to start deploying your project. You SSH in, ready to rock, you type `git clone...` and boom:\r\n\r\n> `bash: git: command not found`\r\n\r\n**Ugh. Frustrating, right?**\r\n\r\nThen you install Git. Then you try to unzip a file. Command not found. Then you realize `htop` isn't there. And worse, halfway through the night, you remember you completely forgot to configure the firewall, leaving your server wide open.\r\n\r\nHonestly, remembering every single utility and security package for every new server is a pain. It‚Äôs repetitive, and manual work leads to mistakes.\r\n\r\nThat‚Äôs why I decided to stop doing it manually and wrote a **\"One-Click\" script** to handle the boring stuff for me. I‚Äôm sharing it here so you can save time (and sanity) too.\r\n\r\n#### The Essentials: What We Are Installing\r\n\r\nBefore we get to the script, here is the \"Survival Kit\" I believe every modern Ubuntu server needs:\r\n\r\n1.  **The Toolbox (System Utilities)**\r\n    * **curl & wget:** For downloading stuff.\r\n    * **git:** Because how else are you getting your code?\r\n    * **vim / nano:** You need to edit config files somehow.\r\n    * **htop:** Because the default `top` is hard to read.\r\n    * **unzip & net-tools:** For managing archives and checking network stats (`ifconfig`).\r\n\r\n2.  **The Bodyguards (Security)**\r\n    * **ufw (Uncomplicated Firewall):** The easiest way to manage ports.\r\n    * **fail2ban:** A must-have. It watches for repeated failed login attempts (brute-force attacks) and automatically bans those IP addresses.\r\n\r\n3.  **The Engine Room (Web & Containers)**\r\n    * **nginx:** A lightweight, high-performance web server and reverse proxy.\r\n    * **docker & docker-compose:** It‚Äôs 2024 (almost 2025!). We shouldn't be installing messy dependencies directly on the OS anymore. Docker keeps everything clean and portable.\r\n\r\n#### The Script\r\n\r\nHere is the magic shell script. It automates everything: updates the system, installs the tools, configures the firewall to allow SSH (so you don't lock yourself out!), and sets up Docker.\r\n\r\n**How to use it:**\r\n\r\n1.  Create a file: `nano setup_server.sh`\r\n2.  Paste the code below.\r\n3.  Make it executable: `chmod +x setup_server.sh`\r\n4.  Run it: `sudo ./setup_server.sh`\r\n\r\n```bash\r\n#!/bin/bash\r\n\r\n# ==========================================\r\n# The Ultimate Ubuntu Server Setup Script\r\n# Author: Khang (Dulkanggg)\r\n# ==========================================\r\n\r\n# 1. Check for Root Privileges\r\nif [ \"$EUID\" -ne 0 ]; then \r\n  echo \"Please run this script as root (use sudo)\"\r\n  exit\r\nfi\r\n\r\necho \"--- STARTING SYSTEM UPDATE ---\"\r\napt update && apt upgrade -y\r\n\r\necho \"--- 1. INSTALLING ESSENTIAL UTILITIES ---\"\r\n# Installing curl, wget, git, htop, vim, unzip, net-tools, etc.\r\napt install -y curl wget git htop vim nano unzip net-tools software-properties-common ca-certificates gnupg lsb-release\r\n\r\necho \"--- 2. SETTING UP SECURITY (UFW & FAIL2BAN) ---\"\r\napt install -y ufw fail2ban\r\n\r\n# Configuring Basic Firewall Rules\r\n# IMPORTANT: We must allow SSH first to prevent locking ourselves out!\r\nufw default deny incoming\r\nufw default allow outgoing\r\nufw allow ssh\r\nufw allow 22/tcp\r\nufw allow 80/tcp\r\nufw allow 443/tcp\r\n\r\n# Enable UFW (Auto-confirm 'yes')\r\necho \"y\" | ufw enable\r\n\r\necho \"--- 3. INSTALLING NGINX (Web Server) ---\"\r\napt install -y nginx\r\nsystemctl start nginx\r\nsystemctl enable nginx\r\n\r\necho \"--- 4. INSTALLING DOCKER & DOCKER COMPOSE ---\"\r\n# Add Docker's official GPG key\r\nmkdir -p /etc/apt/keyrings\r\ncurl -fsSL [https://download.docker.com/linux/ubuntu/gpg](https://download.docker.com/linux/ubuntu/gpg) | gpg --dearmor -o /etc/apt/keyrings/docker.gpg\r\n\r\n# Set up the repository\r\necho \\\r\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] [https://download.docker.com/linux/ubuntu](https://download.docker.com/linux/ubuntu) \\\r\n  $(lsb_release -cs) stable\" | tee /etc/apt/sources.list.d/docker.list > /dev/null\r\n\r\napt update\r\napt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\r\n\r\n# Start Docker service\r\nsystemctl start docker\r\nsystemctl enable docker\r\n\r\n# Add current user to Docker group (so you don't need 'sudo' for docker commands)\r\n# Note: This checks for the user who ran the sudo command\r\nif [ -n \"$SUDO_USER\" ]; then\r\n    usermod -aG docker $SUDO_USER\r\n    echo \"User $SUDO_USER has been added to the docker group.\"\r\nfi\r\n\r\necho \"--- SYSTEM CLEANUP ---\"\r\napt autoremove -y\r\n\r\necho \"==========================================\"\r\necho \"   SETUP COMPLETE! READY TO ROCK.\"\r\necho \"==========================================\"\r\necho \"Versions Installed:\"\r\necho \"- Nginx: $(nginx -v 2>&1 | cut -d '/' -f 2)\"\r\necho \"- Docker: $(docker --version)\"\r\necho \"- UFW Status: $(ufw status | grep 'Status')\"\r\necho \"NOTE: Please logout and login again to apply Docker group permissions.\"\r\n```\r\n---\r\n\r\n### Wrapping Up\r\nAnd that‚Äôs it! In about 2 minutes, you go from a blank slate to a fully secured, Docker-ready server with all the creature comforts installed.\r\nHopefully, this script saves you some time on your next project. Let me know if you think I missed any essential tools in the comments below!\r\nHappy Coding!\r\n\r\n-------\r\n\r\n### H·ªôi ch·ª©ng \"Qu√™n c√†i Git\" v√† chi·∫øc Script c·ª©u c√°nh cho Ubuntu Server m·ªõi\r\n\r\nCh√†o m·ªçi ng∆∞·ªùi,\r\n\r\nCh·∫Øc h·∫≥n ai trong ch√∫ng ta c≈©ng t·ª´ng r∆°i v√†o c·∫£nh n√†y √≠t nh·∫•t m·ªôt (ho·∫∑c nhi·ªÅu) l·∫ßn. B·∫°n v·ª´a thu√™ ƒë∆∞·ª£c m·ªôt con VPS ngon ngh·∫ª, ho·∫∑c v·ª´a t·∫°o xong m·ªôt m√°y ·∫£o (VM) Ubuntu m·ªõi c·ª©ng ƒë·ªÉ l√†m lab. T√¢m tr·∫°ng ƒëang h·ª´ng h·ª±c kh√≠ th·∫ø, SSH v√†o server, g√µ l·ªánh ƒë·∫ßu ti√™n ƒë·ªãnh k√©o source v·ªÅ:\r\n\r\n`git clone ...`\r\n\r\nV√† h·ªá th·ªëng tr·∫£ v·ªÅ m·ªôt c√¢u xanh r·ªùn:\r\n\r\n> `bash: git: command not found`\r\n\r\n**C·ª•t h·ª©ng th·ª±c s·ª±!**\r\n\r\nTh·∫ø l√† l·∫°i ph·∫£i ng·ªìi `apt install git`. Xong xu√¥i, ƒë·ªãnh gi·∫£i n√©n c√°i file data th√¨ l·∫°i thi·∫øu `unzip`. Mu·ªën xem RAM, CPU th·∫ø n√†o cho tr·ª±c quan th√¨ nh·ªõ ra ch∆∞a c√†i `htop`. T·ªá h∆°n n·ªØa l√† h√¨ h·ª•c c·∫£ ƒë√™m deploy xong, s√°ng h√¥m sau m·ªõi t√° h·ªèa nh·∫≠n ra m√¨nh... qu√™n b·∫≠t t∆∞·ªùng l·ª≠a (Firewall), server \"tr·∫ßn tr·ª•i\" gi·ªØa internet.\r\n\r\nVi·ªác nh·ªõ h·∫øt t·∫•t c·∫£ nh·ªØng g√≥i ph·∫ßn m·ªÅm (packages) l·∫∑t v·∫∑t m·ªói khi c√†i l·∫°i m√°y th·ª±c s·ª± r·∫•t phi·ªÅn ph·ª©c v√† t·ªën th·ªùi gian. M√† l√†m th·ªß c√¥ng th√¨ ki·ªÉu g√¨ c≈©ng s√≥t.\r\n\r\nƒê√≥ l√† l√Ω do m√¨nh quy·∫øt ƒë·ªãnh kh√¥ng l√†m \"th·ªß c√¥ng m·ªπ ngh·ªá\" n·ªØa. Thay v√†o ƒë√≥, m√¨nh gom t·∫•t c·∫£ v√†o m·ªôt script duy nh·∫•t. Ch·ªâ c·∫ßn ch·∫°y m·ªôt d√≤ng l·ªánh, ƒëi pha c·ªëc c√† ph√™, quay l·∫°i l√† ƒë√£ c√≥ m·ªôt server \"full option\" ƒë·ªÉ s·∫µn s√†ng chi·∫øn ƒë·∫•u.\r\n\r\nH√¥m nay m√¨nh chia s·∫ª l·∫°i script n√†y cho anh em, hy v·ªçng gi√∫p m·ªçi ng∆∞·ªùi ti·∫øt ki·ªám th·ªùi gian (v√† ƒë·ª° b·ª±c m√¨nh).\r\n\r\n#### B·ªô \"ƒë·ªì ngh·ªÅ\" sinh t·ªìn (Survival Kit) g·ªìm nh·ªØng g√¨?\r\n\r\nTr∆∞·ªõc khi ƒëi v√†o script, ƒëi·ªÉm qua xem ch√∫ng ta s·∫Ω c√†i nh·ªØng g√¨ v√† t·∫°i sao n√≥ c·∫ßn thi·∫øt nh√©:\r\n\r\n**1. Nh√≥m C√¥ng c·ª• (System Utilities) - \"Thi·∫øu th√¨ r·∫•t b·ª±c\"**\r\n\r\n* **curl & wget:** ƒê·ªÉ t·∫£i file, test API.\r\n* **git:** Kh√¥ng c√≥ c√°i n√†y th√¨ l·∫•y code ki·ªÉu g√¨?\r\n* **vim / nano:** ƒê·ªÉ s·ª≠a file config nhanh g·ªçn.\r\n* **htop:** Xem t√†i nguy√™n m√°y (RAM/CPU) s∆∞·ªõng h∆°n l·ªánh `top` m·∫∑c ƒë·ªãnh nhi·ªÅu.\r\n* **unzip & net-tools:** Gi·∫£i n√©n file v√† check IP/Port (`ifconfig`, `netstat`).\r\n\r\n**2. Nh√≥m V·ªá sƒ© (Security)**\r\n\r\n* **ufw:** T∆∞·ªùng l·ª≠a ƒë∆°n gi·∫£n nh·∫•t qu·∫£ ƒë·∫•t. ƒê√≥ng h·∫øt c√°c c·ª≠a, ch·ªâ m·ªü c·ª≠a cho m√¨nh v√†o th√¥i.\r\n* **fail2ban:** Th·∫±ng n√†y c·ª±c hay. N√≥ s·∫Ω canh c·ª≠a SSH, ai g√µ sai m·∫≠t kh·∫©u nhi·ªÅu l·∫ßn l√† n√≥ ch·∫∑n (ban) IP ƒë√≥ lu√¥n. Ch·ªëng d√≤ m·∫≠t kh·∫©u c·ª±c t·ªët.\r\n\r\n**3. Nh√≥m V·∫≠n h√†nh (Engine Room)**\r\n\r\n* **nginx:** Web server nh·∫π, l√†m Reverse Proxy c·ª±c m∆∞·ª£t.\r\n* **docker & docker-compose:** Gi·ªù l√† th·ªùi ƒë·∫°i c·ªßa Container r·ªìi. C√†i database, redis hay app th√¨ c·ª© ƒë√≥ng v√†o Docker cho s·∫°ch m√°y, ƒë·ª° xung ƒë·ªôt th∆∞ vi·ªán.\r\n\r\n---\r\n\r\n#### Script \"One-Click\" (T·ª± ƒë·ªông h√≥a)\r\n\r\nƒê√¢y l√† ƒëo·∫°n script bash s·∫Ω l√†m h·∫øt m·ªçi vi·ªác t·ª´ A-Z: c·∫≠p nh·∫≠t h·ªá th·ªëng, c√†i tool, v√† quan tr·ªçng nh·∫•t l√† c·∫•u h√¨nh Firewall chu·∫©n ƒë·ªÉ b·∫°n kh√¥ng b·ªã... t·ª± nh·ªët m√¨nh ·ªü ngo√†i (do ch·∫∑n nh·∫ßm port SSH).\r\n\r\n**C√°ch d√πng:**\r\n\r\n1.  T·∫°o file m·ªõi: `nano setup_server.sh`\r\n2.  Copy n·ªôi dung b√™n d∆∞·ªõi d√°n v√†o.\r\n3.  C·∫•p quy·ªÅn ch·∫°y: `chmod +x setup_server.sh`\r\n4.  Ch·∫°y script (c·∫ßn quy·ªÅn root): `sudo ./setup_server.sh`\r\n\r\n```bash\r\n#!/bin/bash\r\n\r\n# ==========================================\r\n# Script C√†i ƒë·∫∑t Ubuntu Server \"Full Option\"\r\n# T√°c gi·∫£: Khang (Dulkanggg)\r\n# ==========================================\r\n\r\n# 1. Ki·ªÉm tra xem c√≥ ph·∫£i ƒëang ch·∫°y b·∫±ng quy·ªÅn Root kh√¥ng\r\nif [ \"$EUID\" -ne 0 ]; then \r\n  echo \"L·ªói: B·∫°n ph·∫£i ch·∫°y script n√†y b·∫±ng quy·ªÅn root (sudo)\"\r\n  exit\r\nfi\r\n\r\necho \"--- B·∫ÆT ƒê·∫¶U C·∫¨P NH·∫¨T H·ªÜ TH·ªêNG (Ng·ªìi ch·ªù x√≠u nh√©...) ---\"\r\napt update && apt upgrade -y\r\n\r\necho \"--- 1. C√ÄI ƒê·∫∂T C√îNG C·ª§ C∆† B·∫¢N (Utilities) ---\"\r\n# M·∫•y c√°i n√†y thi·∫øu l√† r·∫•t kh√≥ ch·ªãu\r\napt install -y curl wget git htop vim nano unzip net-tools software-properties-common ca-certificates gnupg lsb-release\r\n\r\necho \"--- 2. C√ÄI ƒê·∫∂T B·∫¢O M·∫¨T (UFW & FAIL2BAN) ---\"\r\napt install -y ufw fail2ban\r\n\r\n# C·∫•u h√¨nh T∆∞·ªùng l·ª≠a (Firewall)\r\n# QUAN TR·ªåNG: Ph·∫£i m·ªü port SSH (22) tr∆∞·ªõc, kh√¥ng l√† m·∫•t k·∫øt n·ªëi lu√¥n!\r\nufw default deny incoming  # Ch·∫∑n t·∫•t c·∫£ chi·ªÅu v√†o\r\nufw default allow outgoing # Cho ph√©p t·∫•t c·∫£ chi·ªÅu ra\r\nufw allow ssh              # M·ªü c·ªïng SSH\r\nufw allow 22/tcp\r\nufw allow 80/tcp           # M·ªü c·ªïng Web (HTTP)\r\nufw allow 443/tcp          # M·ªü c·ªïng Web (HTTPS)\r\n\r\n# K√≠ch ho·∫°t UFW (T·ª± ƒë·ªông ch·ªçn 'yes')\r\necho \"y\" | ufw enable\r\n\r\necho \"--- 3. C√ÄI ƒê·∫∂T NGINX (Web Server) ---\"\r\napt install -y nginx\r\nsystemctl start nginx\r\nsystemctl enable nginx\r\n\r\necho \"--- 4. C√ÄI ƒê·∫∂T DOCKER & DOCKER COMPOSE ---\"\r\n# Th√™m key ch√≠nh th·ª©c c·ªßa Docker\r\nmkdir -p /etc/apt/keyrings\r\ncurl -fsSL [https://download.docker.com/linux/ubuntu/gpg](https://download.docker.com/linux/ubuntu/gpg) | gpg --dearmor -o /etc/apt/keyrings/docker.gpg\r\n\r\n# Thi·∫øt l·∫≠p repository t·∫£i v·ªÅ\r\necho \\\r\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] [https://download.docker.com/linux/ubuntu](https://download.docker.com/linux/ubuntu) \\\r\n  $(lsb_release -cs) stable\" | tee /etc/apt/sources.list.d/docker.list > /dev/null\r\n\r\napt update\r\napt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\r\n\r\n# B·∫≠t Docker service\r\nsystemctl start docker\r\nsystemctl enable docker\r\n\r\n# Th√™m user hi·ªán t·∫°i v√†o nh√≥m docker (ƒë·ªÉ g√µ l·ªánh docker kh√¥ng c·∫ßn th√™m sudo)\r\nif [ -n \"$SUDO_USER\" ]; then\r\n    usermod -aG docker $SUDO_USER\r\n    echo \"ƒê√£ th√™m user $SUDO_USER v√†o nh√≥m docker.\"\r\nfi\r\n\r\necho \"--- D·ªåN D·∫∏P R√ÅC H·ªÜ TH·ªêNG ---\"\r\napt autoremove -y\r\n\r\necho \"==========================================\"\r\necho \"   C√ÄI ƒê·∫∂T HO√ÄN T·∫§T! CHI·∫æN TH√îI.\"\r\necho \"==========================================\"\r\necho \"C√°c phi√™n b·∫£n ƒë√£ c√†i:\"\r\necho \"- Nginx: $(nginx -v 2>&1 | cut -d '/' -f 2)\"\r\necho \"- Docker: $(docker --version)\"\r\necho \"- T∆∞·ªùng l·ª≠a (UFW): $(ufw status | grep 'Status')\"\r\necho \"L∆ØU √ù: H√£y Logout v√† Login l·∫°i ƒë·ªÉ √°p d·ª•ng quy·ªÅn Docker nh√©!\"\r\n```\r\n---\r\n### L·ªùi k·∫øt\r\nV·∫≠y l√† xong! Ch·ªâ m·∫•t t·∫ßm 2-3 ph√∫t ch·∫°y script, b·∫°n ƒë√£ bi·∫øn m·ªôt con server \"tr·∫Øng tr∆°n\" th√†nh m·ªôt m√¥i tr∆∞·ªùng ƒë·∫ßy ƒë·ªß ti·ªán nghi, b·∫£o m·∫≠t c∆° b·∫£n t·ªët v√† s·∫µn s√†ng ch·∫°y Docker.\r\n\r\nHy v·ªçng c√°i script nh·ªè n√†y gi√∫p √≠ch cho anh em trong qu√° tr√¨nh \"v·ªçc v·∫°ch\" server. N·∫øu anh em th·∫•y c√≤n thi·∫øu m√≥n \"ƒë·ªì ch∆°i\" n√†o quan tr·ªçng n·ªØa th√¨ comment b√™n d∆∞·ªõi ƒë·ªÉ m√¨nh b·ªï sung v√†o script nh√©!"},{"title":"Hello World! Welcome to Dulkanggg's Corner","slug":"welcome-blog","date":"2025-12-01","tags":["intro","cybersecurity","personal","bilingual"],"body":"> *üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).*\r\n\r\n---\r\n\r\n### Hello World!\r\n\r\nHi everyone, I'm **Khang**.\r\n\r\nI am a Cybersecurity fresher on a journey to become an IT Security Officer, and eventually a Cyber Security Consultant (ambitious, I know!). Currently, I act as a penetration tester, a red teamer, a bounty hunter, and a self-proclaimed ethical hacker. I am a big fan of new technologies, but generally, I'm just an ordinary man.\r\n\r\nWelcome to **Dulkanggg's Corner**, my personal space on the internet.\r\n\r\n#### What is this place?\r\n\r\nThis website is where I archive interesting news, articles, tutorials, and links that I find useful or intriguing. The content here mainly revolves around:\r\n\r\n* **Cybersecurity:** Write-ups, CTF solutions, and security concepts.\r\n* **IT & Tech:** Networking, Linux, and setting up local environments.\r\n* **My Projects:** Updates on things I'm building (like e-commerce platforms or security tools).\r\n\r\nI hope you will find useful information on my website.\r\n\r\nFeel free to connect with me on social media or drop me an email. I usually respond within a few days.\r\n\r\n* [GitHub](https://github.com/khanchannn)\r\n* [Facebook](https://www.facebook.com/dulkanggg1504/)\r\n* [Email](mailto:dulkanggg1504@gmail.com)\r\n\r\n---\r\n\r\n### Xin ch√†o!\r\n\r\nCh√†o m·ªçi ng∆∞·ªùi, m√¨nh l√† **Khang**.\r\n\r\nHi·ªán t·∫°i, m√¨nh l√† m·ªôt ng∆∞·ªùi m·ªõi (fresher) trong lƒ©nh v·ª±c An ninh m·∫°ng. M·ª•c ti√™u c·ªßa m√¨nh l√† tr·ªü th√†nh m·ªôt Chuy√™n vi√™n An ninh CNTT v√† sau ƒë√≥ l√† Chuy√™n gia T∆∞ v·∫•n An ninh m·∫°ng. Hi·ªán t·∫°i, m√¨nh ƒëang t√¨m hi·ªÉu v√† th·ª±c h√†nh c√°c vai tr√≤ nh∆∞ penetration tester, red teamer, sƒÉn l·ªói nh·∫≠n th∆∞·ªüng (bounty hunter), v√† l√† m·ªôt ethical hacker t·ª± phong. M√¨nh r·∫•t th√≠ch t√¨m hi·ªÉu c√°c c√¥ng ngh·ªá m·ªõi, nh∆∞ng nh√¨n chung, m√¨nh c≈©ng ch·ªâ l√† m·ªôt ng∆∞·ªùi b√¨nh th∆∞·ªùng nh∆∞ bao ng∆∞·ªùi kh√°c.\r\n\r\nCh√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi **Dulkanggg's Corner**, g√≥c nh·ªè c·ªßa m√¨nh tr√™n Internet.\r\n\r\n#### Trang web n√†y d√πng ƒë·ªÉ l√†m g√¨?\r\n\r\nƒê√¢y l√† n∆°i m√¨nh l∆∞u tr·ªØ v√† chia s·∫ª nh·ªØng tin t·ª©c th√∫ v·ªã, c√°c b√†i vi·∫øt, h∆∞·ªõng d·∫´n (tutorial) v√† c√°c li√™n k·∫øt m√† m√¨nh th·∫•y h·ªØu √≠ch. N·ªôi dung ·ªü ƒë√¢y ch·ªß y·∫øu xoay quanh:\r\n\r\n* **An ninh m·∫°ng (Cybersecurity):** C√°c b√†i vi·∫øt chia s·∫ª ki·∫øn th·ª©c, gi·∫£i c√°c b√†i t·∫≠p CTF, v√† c√°c kh√°i ni·ªám b·∫£o m·∫≠t.\r\n* **CNTT & C√¥ng ngh·ªá:** M·∫°ng m√°y t√≠nh, Linux, v√† c√°ch thi·∫øt l·∫≠p c√°c m√¥i tr∆∞·ªùng server/lab c·ª•c b·ªô.\r\n* **D·ª± √°n c√° nh√¢n:** C·∫≠p nh·∫≠t v·ªÅ nh·ªØng th·ª© m√¨nh ƒëang x√¢y d·ª±ng (nh∆∞ c√°c n·ªÅn t·∫£ng web ho·∫∑c c√¥ng c·ª• b·∫£o m·∫≠t).\r\n\r\nM√¨nh hy v·ªçng b·∫°n s·∫Ω t√¨m th·∫•y nh·ªØng th√¥ng tin h·ªØu √≠ch t·∫°i ƒë√¢y.\r\n\r\nƒê·ª´ng ng·∫ßn ng·∫°i k·∫øt n·ªëi v·ªõi m√¨nh qua m·∫°ng x√£ h·ªôi ho·∫∑c g·ª≠i email cho m√¨nh. M√¨nh th∆∞·ªùng ph·∫£n h·ªìi trong v√≤ng v√†i ng√†y.\r\n\r\n* [GitHub](https://github.com/khanchannn)\r\n* [Facebook](https://www.facebook.com/dulkanggg1504/)\r\n* [Email](mailto:dulkanggg1504@gmail.com)"}]