<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Fail2Ban: Protecting Your Server
    </title>
    <link rel="icon" href="/dulkanggg/images/logo.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/dulkanggg/css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <a href="/dulkanggg/" class="logo">
                <img src="/dulkanggg/images/logo.png" alt="Logo"
                    style="height: 40px; vertical-align: middle; margin-right: 10px;">
                Dulkanggg's Corner
            </a>
            <nav>
                <a href="/dulkanggg/">Home</a>
                <a href="/dulkanggg/search.html">Search</a>
                <a href="/dulkanggg/about">About</a>
                <a href="/dulkanggg/rss">RSS</a>
            </nav>
        </header>

    <article class="post-content">
        <h1 style="color: #e2b714;">
            Fail2Ban: Protecting Your Server
        </h1>
        <div style="color: var(--accent-color); margin-bottom: 20px;">
            <span>
                2025-12-05
            </span>
            
                | Tags:
                
                    <a href="/dulkanggg/tags/ubuntu"
                        style="color: var(--accent-color); text-decoration: underline;">
                        ubuntu
                    </a>
                    
                    <a href="/dulkanggg/tags/vps"
                        style="color: var(--accent-color); text-decoration: underline;">
                        vps
                    </a>
                    
                    <a href="/dulkanggg/tags/security"
                        style="color: var(--accent-color); text-decoration: underline;">
                        security
                    </a>
                    
                    <a href="/dulkanggg/tags/network"
                        style="color: var(--accent-color); text-decoration: underline;">
                        network
                    </a>
                    
                    <a href="/dulkanggg/tags/bilingual"
                        style="color: var(--accent-color); text-decoration: underline;">
                        bilingual
                    </a>
                    
                    <a href="/dulkanggg/tags/fail2ban"
                        style="color: var(--accent-color); text-decoration: underline;">
                        fail2ban
                    </a>
                    
                        
        </div>

        <div>
            <blockquote>
<p><em>üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).</em></p>
</blockquote>
<hr>
<h3>Fail2Ban: The Diligent &quot;Bodyguard&quot; Protecting Your Server</h3>
<p>Hello everyone! If you operate a server (VPS/Dedicated), you surely know that uneasy feeling of seeing thousands of unauthorized login attempts (brute-force) hitting your system daily.</p>
<p>Don&#39;t worry, Fail2Ban was born to solve this. Think of Fail2Ban as a security guard who reads your server logs 24/7. The moment he spots suspicious activity (like too many wrong passwords), he immediately signals the Firewall to &quot;lock out&quot; that intruder.</p>
<p>Today, I‚Äôll guide you from A to Z on how to install and use this amazing tool.</p>
<h3>1. Installation (Easy as Pie)</h3>
<p>On popular operating systems like Ubuntu or Debian, you only need one command:</p>
<pre><code class="language-bash">sudo apt install fail2ban
</code></pre>
<h3>2. Configuration: The Rules of the Game</h3>
<p>This is the most important part. Fail2Ban has a very cool configuration principle: It reads <code>.conf</code> files first, but it will prioritize <code>.local</code> files.</p>
<p><strong>Tip:</strong> Never edit the <code>.conf</code> file directly. Copy it to a <code>.local</code> file to edit. This helps you keep the original file intact and prevents losing your configuration when the software updates.</p>
<p>Create a local configuration file:</p>
<pre><code class="language-bash">sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
</code></pre>
<p>Now open the <code>/etc/fail2ban/jail.local</code> file and edit the core parameters:</p>
<ul>
<li><strong>ignoreip</strong>: The &quot;Death Exemption&quot; list. Enter your own IP or your company&#39;s IP here to avoid accidentally locking yourself out if you type the wrong password.</li>
<li><strong>bantime</strong>: The &quot;Jail time&quot; (in seconds). Default is 600s (10 minutes). I usually increase this to 3600s or more just to be safe.</li>
<li><strong>findtime &amp; maxretry</strong>: This is the &quot;Three strikes and you&#39;re out&quot; rule. Example: Within the <code>findtime</code> window (10 minutes), if there are more than <code>maxretry</code> (3) failed attempts, then BAN.</li>
</ul>
<p><strong>Example SSH protection configuration:</strong>
By default, SSH is enabled, but you should double-check the <code>[ssh]</code> block:</p>
<pre><code class="language-ini">[ssh]
enabled  = true
port     = ssh      # If you changed your SSH port (e.g., 2222), enter 2222 here
filter   = sshd
logpath  = /var/log/auth.log
maxretry = 3
</code></pre>
<h3>3. Advanced: Creating Custom Filters for Websites</h3>
<p>Fail2Ban doesn&#39;t just protect SSH; it can protect Nginx, Apache, or even your WordPress login page. The principle is using Regex (Regular Expressions) to scan logs. For example, let&#39;s say you want to block someone trying to brute-force <code>wp-login.php</code>.</p>
<p><strong>Step 1: Check the log</strong>
See what traces the attacker leaves. Example in <code>/var/log/nginx/access.log</code>:
<code>123.123.123.123 ... &quot;POST /wp-login.php HTTP/1.1&quot; 200 ...</code></p>
<p><strong>Step 2: Write the Regex</strong>
We will translate the log line above into a language Fail2Ban understands:
<code>&lt;HOST&gt; - - \[(\d{2})/\w{3}/\d{4}:\1:\1:\1 -\d{4}\] &quot;POST /wp-login.php HTTP/1.1&quot; 200</code></p>
<p><strong>Step 3: Create a new filter</strong>
Create the file <code>/etc/fail2ban/filter.d/wordpress.conf</code>:</p>
<pre><code class="language-ini">[Definition]
failregex = &lt;HOST&gt; - - \[(\d{2})/\w{3}/\d{4}:\1:\1:\1 -\d{4}\] &quot;POST /wp-login.php HTTP/1.1&quot; 200
ignoreregex =
</code></pre>
<p>Then remember to restart the service:</p>
<pre><code class="language-bash">sudo service fail2ban restart
</code></pre>
<h3>4. Management and Monitoring</h3>
<p>Once installed, you need to know what it&#39;s actually doing, right?</p>
<p><strong>See how many &quot;bad guys&quot; Fail2Ban has caught:</strong></p>
<pre><code class="language-bash">sudo fail2ban-client status
</code></pre>
<p><strong>See the list of IPs currently blocked in the firewall:</strong></p>
<pre><code class="language-bash">sudo iptables -L -n -v
</code></pre>
<h3>5. For Pros: Installing the Latest Version from Source</h3>
<p>Sometimes the repository (Repo) on Ubuntu/Debian is a bit outdated. If you want the latest features (like better IPv6 support), install it manually.</p>
<p><strong>Step 1: Remove the old version</strong></p>
<pre><code class="language-bash">sudo apt purge fail2ban
</code></pre>
<p><strong>Step 2: Download and Install</strong>
Visit the Fail2Ban Github to get the link for the latest version, then:</p>
<pre><code class="language-bash"># Download and extract (e.g., version 0.10.4)
tar xvfj fail2ban-0.10.4.tar.bz2
cd fail2ban-0.10.4

# Install via Python
sudo python setup.py install
</code></pre>
<p><strong>Step 3: Create a System Boot Service</strong>
Since you installed it manually, you need to copy the init script yourself:</p>
<pre><code class="language-bash">cp files/debian-initd /etc/init.d/fail2ban
update-rc.d fail2ban defaults
service fail2ban start
</code></pre>
<p>Then verify it with the command <code>fail2ban-client version</code> and you&#39;re done!</p>
<hr>
<h3>Fail2Ban: Ch√†ng &quot;V·ªá sƒ©&quot; C·∫ßn M·∫´n B·∫£o V·ªá Server C·ªßa B·∫°n</h3>
<p>Ch√†o m·ªçi ng∆∞·ªùi! N·∫øu b·∫°n ƒëang v·∫≠n h√†nh m·ªôt server (VPS/Dedicated), ch·∫Øc h·∫≥n b·∫°n bi·∫øt c·∫£m gi√°c b·∫•t an khi h√†ng ng√†y c√≥ h√†ng ng√†n l∆∞·ª£t c·ªë g·∫Øng ƒëƒÉng nh·∫≠p tr√°i ph√©p (brute-force) v√†o h·ªá th·ªëng.</p>
<p>ƒê·ª´ng lo, Fail2Ban sinh ra l√† ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y. H√£y t∆∞·ªüng t∆∞·ª£ng Fail2Ban nh∆∞ m·ªôt ng∆∞·ªùi b·∫£o v·ªá ng·ªìi ƒë·ªçc nh·∫≠t k√Ω (logs) c·ªßa server 24/7. H·ªÖ th·∫•y ai c√≥ d·∫•u hi·ªáu kh·∫£ nghi (nh∆∞ g√µ sai m·∫≠t kh·∫©u qu√° nhi·ªÅu l·∫ßn), anh ta s·∫Ω l·∫≠p t·ª©c b√°o cho t∆∞·ªùng l·ª≠a (Firewall) &quot;c·∫•m c·ª≠a&quot; k·∫ª ƒë√≥ ngay l·∫≠p t·ª©c.</p>
<p>H√¥m nay m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n t·ª´ A-Z c√°ch c√†i ƒë·∫∑t v√† s·ª≠ d·ª•ng c√¥ng c·ª• tuy·ªát v·ªùi n√†y nh√©.</p>
<h3>1. C√†i ƒë·∫∑t (D·ªÖ nh∆∞ ƒÉn k·∫πo)</h3>
<p>Tr√™n c√°c h·ªá ƒëi·ªÅu h√†nh ph·ªï bi·∫øn nh∆∞ Ubuntu hay Debian, b·∫°n ch·ªâ c·∫ßn m·ªôt c√¢u l·ªánh:</p>
<pre><code class="language-bash">sudo apt install fail2ban
</code></pre>
<h3>2. C·∫•u h√¨nh: Quy t·∫Øc c·ªßa tr√≤ ch∆°i</h3>
<p>ƒê√¢y l√† ph·∫ßn quan tr·ªçng nh·∫•t. Fail2Ban c√≥ m·ªôt nguy√™n t·∫Øc c·∫•u h√¨nh r·∫•t hay: N√≥ ƒë·ªçc file <code>.conf</code> tr∆∞·ªõc, nh∆∞ng s·∫Ω ∆∞u ti√™n file <code>.local</code>.</p>
<p><strong>M·∫πo:</strong> ƒê·ª´ng bao gi·ªù s·ª≠a tr·ª±c ti·∫øp file <code>.conf</code>. H√£y copy ra file <code>.local</code> ƒë·ªÉ s·ª≠a. ƒêi·ªÅu n√†y gi√∫p b·∫°n gi·ªØ nguy√™n file g·ªëc v√† kh√¥ng b·ªã m·∫•t c·∫•u h√¨nh khi c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm.</p>
<p>T·∫°o file c·∫•u h√¨nh local:</p>
<pre><code class="language-bash">sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
</code></pre>
<p>B√¢y gi·ªù h√£y m·ªü file <code>/etc/fail2ban/jail.local</code> v√† ch·ªânh s·ª≠a c√°c th√¥ng s·ªë c·ªët l√µi:</p>
<ul>
<li><strong>ignoreip</strong>: Danh s√°ch c√°c IP &quot;ƒë∆∞·ª£c mi·ªÖn t·ª≠&quot;. H√£y ƒëi·ªÅn IP c·ªßa ch√≠nh b·∫°n ho·∫∑c c√¥ng ty v√†o ƒë√¢y ƒë·ªÉ tr√°nh tr∆∞·ªùng h·ª£p l·ª° tay g√µ sai m·∫≠t kh·∫©u m√† t·ª± nh·ªët m√¨nh ·ªü ngo√†i.</li>
<li><strong>bantime</strong>: Th·ªùi gian &quot;ƒëi t√π&quot; (t√≠nh b·∫±ng gi√¢y). M·∫∑c ƒë·ªãnh l√† 600s (10 ph√∫t). M√¨nh th∆∞·ªùng tƒÉng l√™n 3600s ho·∫∑c h∆°n cho ch·∫Øc ƒÉn.</li>
<li><strong>findtime &amp; maxretry</strong>: ƒê√¢y l√† lu·∫≠t &quot;qu√° tam ba b·∫≠n&quot;. V√≠ d·ª•: Trong kho·∫£ng th·ªùi gian <code>findtime</code> (10 ph√∫t), n·∫øu ƒëƒÉng nh·∫≠p sai qu√° <code>maxretry</code> (3 l·∫ßn) th√¨ BAN.</li>
</ul>
<p><strong>V√≠ d·ª• c·∫•u h√¨nh b·∫£o v·ªá SSH:</strong>
M·∫∑c ƒë·ªãnh SSH ƒë√£ ƒë∆∞·ª£c b·∫≠t, nh∆∞ng b·∫°n n√™n ki·ªÉm tra l·∫°i ƒëo·∫°n c·∫•u h√¨nh <code>[ssh]</code>:</p>
<pre><code class="language-ini">[ssh]
enabled  = true
port     = ssh      # N·∫øu b·∫°n ƒë·ªïi port SSH (v√≠ d·ª• 2222), h√£y ƒëi·ªÅn s·ªë 2222 v√†o ƒë√¢y
filter   = sshd
logpath  = /var/log/auth.log
maxretry = 3
</code></pre>
<h3>3. N√¢ng cao: T·ª± t·∫°o b·ªô l·ªçc (Filters) cho Website</h3>
<p>Fail2Ban kh√¥ng ch·ªâ b·∫£o v·ªá SSH, n√≥ b·∫£o v·ªá ƒë∆∞·ª£c c·∫£ Nginx, Apache hay th·∫≠m ch√≠ l√† trang ƒëƒÉng nh·∫≠p WordPress c·ªßa b·∫°n.</p>
<p>Nguy√™n l√Ω l√† s·ª≠ d·ª•ng Regex (Bi·ªÉu th·ª©c ch√≠nh quy) ƒë·ªÉ soi log. V√≠ d·ª• b·∫°n mu·ªën ch·∫∑n ai ƒë√≥ c·ªë d√≤ m·∫≠t kh·∫©u trang <code>wp-login.php</code>.</p>
<p><strong>B∆∞·ªõc 1: Soi log</strong>
Xem k·∫ª t·∫•n c√¥ng ƒë·ªÉ l·∫°i d·∫•u v·∫øt g√¨. V√≠ d·ª• trong <code>/var/log/nginx/access.log</code>:
<code>123.123.123.123 ... &quot;POST /wp-login.php HTTP/1.1&quot; 200 ...</code></p>
<p><strong>B∆∞·ªõc 2: Vi·∫øt Regex</strong>
Ch√∫ng ta s·∫Ω chuy·ªÉn d√≤ng log tr√™n th√†nh ng√¥n ng·ªØ m√† Fail2Ban hi·ªÉu:
<code>&lt;HOST&gt; - - \[(\d{2})/\w{3}/\d{4}:\1:\1:\1 -\d{4}\] &quot;POST /wp-login.php HTTP/1.1&quot; 200</code></p>
<p><strong>B∆∞·ªõc 3: T·∫°o filter m·ªõi</strong>
T·∫°o file <code>/etc/fail2ban/filter.d/wordpress.conf</code>:</p>
<pre><code class="language-ini">[Definition]
failregex = &lt;HOST&gt; - - \[(\d{2})/\w{3}/\d{4}:\1:\1:\1 -\d{4}\] &quot;POST /wp-login.php HTTP/1.1&quot; 200
ignoreregex =
</code></pre>
<p>Sau ƒë√≥ nh·ªõ restart l·∫°i service nh√©:</p>
<pre><code class="language-bash">sudo service fail2ban restart
</code></pre>
<h3>4. Qu·∫£n l√Ω v√† Theo d√µi</h3>
<p>C√†i xong r·ªìi th√¨ ph·∫£i bi·∫øt xem n√≥ ƒëang l√†m g√¨ ch·ª© nh·ªâ?</p>
<p><strong>Xem Fail2Ban ƒëang &quot;b·∫Øt&quot; ƒë∆∞·ª£c bao nhi√™u ƒë·ª©a:</strong></p>
<pre><code class="language-bash">sudo fail2ban-client status
</code></pre>
<p><strong>Xem danh s√°ch IP ƒëang b·ªã ch·∫∑n trong t∆∞·ªùng l·ª≠a:</strong></p>
<pre><code class="language-bash">sudo iptables -L -n -v
</code></pre>
<h3>5. D√†nh cho Pro: C√†i ƒë·∫∑t phi√™n b·∫£n m·ªõi nh·∫•t t·ª´ Source</h3>
<p>ƒê√¥i khi kho ·ª©ng d·ª•ng (Repo) c·ªßa Ubuntu/Debian c·∫≠p nh·∫≠t kh√° ch·∫≠m. N·∫øu b·∫°n mu·ªën d√πng c√°c t√≠nh nƒÉng m·ªõi nh·∫•t (nh∆∞ h·ªó tr·ª£ IPv6 t·ªët h∆°n), h√£y c√†i th·ªß c√¥ng.</p>
<p><strong>B∆∞·ªõc 1: G·ª° b·∫£n c≈©</strong></p>
<pre><code class="language-bash">sudo apt purge fail2ban
</code></pre>
<p><strong>B∆∞·ªõc 2: T·∫£i v√† c√†i ƒë·∫∑t</strong>
Truy c·∫≠p Github c·ªßa Fail2Ban ƒë·ªÉ l·∫•y link b·∫£n m·ªõi nh·∫•t, sau ƒë√≥:</p>
<pre><code class="language-bash"># T·∫£i v·ªÅ v√† gi·∫£i n√©n (v√≠ d·ª• b·∫£n 0.10.4)
tar xvfj fail2ban-0.10.4.tar.bz2
cd fail2ban-0.10.4

# C√†i ƒë·∫∑t b·∫±ng Python
sudo python setup.py install
</code></pre>
<p><strong>B∆∞·ªõc 3: T·∫°o service kh·ªüi ƒë·ªông c√πng Windows</strong>
V√¨ c√†i th·ªß c√¥ng n√™n b·∫°n ph·∫£i t·ª± copy file kh·ªüi ƒë·ªông (init script):</p>
<pre><code class="language-bash">cp files/debian-initd /etc/init.d/fail2ban
update-rc.d fail2ban defaults
service fail2ban start
</code></pre>
<p>Sau ƒë√≥ ki·ªÉm tra l·∫°i b·∫±ng l·ªánh <code>fail2ban-client version</code> l√† xong!</p>

        </div>
    </article>

    <div style="margin-top: 40px;">
        <a href="/dulkanggg/">&larr; Back to Home</a>
    </div>

    <footer>
    <p>&copy; 2025 Khang. All rights reserved.</p>
    <div class="social-links">
        <a href="https://github.com/khanchannn" target="_blank">GitHub</a>
        <a href="https://www.facebook.com/dulkanggg1504/" target="_blank">Facebook</a>
        <a href="mailto:dulkanggg1504@gmail.com">Email</a>
    </div>
</footer>
</div> <!-- End container -->
</body>

</html>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const codeBlocks = document.querySelectorAll('.post-content pre');

                codeBlocks.forEach(pre => {
                    const button = document.createElement('button');
                    button.className = 'copy-btn';
                    button.textContent = 'Copy';

                    button.addEventListener('click', () => {
                        const code = pre.querySelector('code').innerText;
                        navigator.clipboard.writeText(code).then(() => {
                            button.textContent = 'Copied!';
                            setTimeout(() => {
                                button.textContent = 'Copy';
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy:', err);
                            button.textContent = 'Error';
                        });
                    });

                    pre.appendChild(button);
                });
            });
        </script>