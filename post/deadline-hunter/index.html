<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Deadline Hunter #1
    </title>
    <link rel="icon" href="/dulkanggg/images/logo.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/dulkanggg/css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <a href="/dulkanggg/" class="logo">
                <img src="/dulkanggg/images/logo.png" alt="Logo"
                    style="height: 40px; vertical-align: middle; margin-right: 10px;">
                Dulkanggg's Corner
            </a>
            <nav>
                <a href="/dulkanggg/">Home</a>
                <a href="/dulkanggg/search.html">Search</a>
                <a href="/dulkanggg/about">About</a>
                <a href="/dulkanggg/rss">RSS</a>
            </nav>
        </header>

    <article class="post-content">
        <h1 style="color: #e2b714;">
            Deadline Hunter #1
        </h1>
        <div style="color: var(--accent-color); margin-bottom: 20px;">
            <span>
                2025-12-09
            </span>
            
                | Tags:
                
                    <a href="/dulkanggg/tags/devlog"
                        style="color: var(--accent-color); text-decoration: underline;">
                        devlog
                    </a>
                    
                    <a href="/dulkanggg/tags/n8n"
                        style="color: var(--accent-color); text-decoration: underline;">
                        n8n
                    </a>
                    
                    <a href="/dulkanggg/tags/ai"
                        style="color: var(--accent-color); text-decoration: underline;">
                        ai
                    </a>
                    
                    <a href="/dulkanggg/tags/gemini"
                        style="color: var(--accent-color); text-decoration: underline;">
                        gemini
                    </a>
                    
                    <a href="/dulkanggg/tags/docker"
                        style="color: var(--accent-color); text-decoration: underline;">
                        docker
                    </a>
                    
                    <a href="/dulkanggg/tags/bilingual"
                        style="color: var(--accent-color); text-decoration: underline;">
                        bilingual
                    </a>
                    
                    <a href="/dulkanggg/tags/devops"
                        style="color: var(--accent-color); text-decoration: underline;">
                        devops
                    </a>
                    
                        
        </div>

        <div>
            <blockquote>
<p><em>üáªüá≥ B·∫£n ti·∫øng Vi·ªát n·∫±m ·ªü ph√≠a d∆∞·ªõi b√†i vi·∫øt (Vietnamese version is available below).</em></p>
</blockquote>
<hr>
<h3>DevLog #1: How I Built &quot;Deadline Hunter&quot; with n8n and Gemini AI ü§ñ</h3>
<h3>1. The Idea &amp; The Problem üí°</h3>
<p>As a student, my biggest pain point is missing deadlines. Assignment notifications and exam schedules are usually scattered across Zalo/Telegram groups, scrolling away quickly and forgotten by everyone.</p>
<p>I decided to build &quot;Deadline Hunter&quot; - a smart Bot. I just need to forward a message or send a photo of the whiteboard to it. It will automatically read, extract the date and time, and save it to the system to remind me later.</p>
<h3>2. Infrastructure as Code üèóÔ∏è</h3>
<p>Instead of manual installation, I use Docker to package everything. This ensures the dev environment is identical to the deploy environment later (DevSecOps mindset).</p>
<p><strong>The &quot;Holy Grail&quot; <code>docker-compose.yml</code> File</strong>
After many times fixing tunnel errors (408 timeout), here is the most stable version using Cloudflare Quick Tunnel:</p>
<pre><code class="language-yaml">version: &#39;3.8&#39;

services:
  # 1. Database: Storage memory
  postgres:
    image: postgres:15-alpine
    container_name: deadline-postgres
    restart: always
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin_password_123
      POSTGRES_DB: deadline_db
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
    networks:
      - app-network
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U admin -d deadline_db&quot;]
      interval: 5s
      timeout: 5s
      retries: 5

  # 2. Automation: The brain processing the flow
  n8n:
    image: n8nio/n8n:latest
    container_name: deadline-n8n
    restart: always
    ports:
      - &quot;5678:5678&quot;
    environment:
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - N8N_SECURE_COOKIE=false
      # Link will be filled after Cloudflare starts
      - WEBHOOK_URL=https://&lt;your-tunnel-url&gt;.trycloudflare.com
    volumes:
      - ./n8n_data:/home/node/.n8n
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # 3. Networking: Tunnel to Internet (Bypass NAT/Firewall)
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: deadline-tunnel
    restart: always
    command: tunnel --url http://n8n:5678
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
</code></pre>
<p><strong>CLI Commands Used:</strong></p>
<pre><code class="language-bash"># Start the system
sudo docker-compose up -d

# View logs to get Tunnel link (important)
sudo docker logs -f deadline-tunnel

# Restart only n8n when updating Webhook URL
sudo docker-compose restart n8n
</code></pre>
<h3>3. Database Schema Design üóÑÔ∏è</h3>
<p>I accessed the Postgres container to create the table. The table structure is designed to support user identification via Telegram ID.</p>
<p><strong>DB Access Command:</strong></p>
<pre><code class="language-bash">docker exec -it deadline-postgres psql -U admin -d deadline_db
</code></pre>
<p><strong>Initialization SQL Script:</strong></p>
<pre><code class="language-sql">-- Users Table: Stores who is who
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    telegram_chat_id VARCHAR(50) UNIQUE,
    full_name VARCHAR(255),
    email VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Tasks Table: Stores things to do
CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    due_date TIMESTAMP,
    is_reminded BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);
</code></pre>
<h3>4. Building the AI &quot;Brain&quot; in n8n üß†</h3>
<p>This is the most interesting part. The processing workflow goes through 4 steps:</p>
<p><strong>Step 1: Telegram Trigger (The Ears)</strong></p>
<ul>
<li>Receive message from User.</li>
<li>Use Webhook from Cloudflare Tunnel to ensure stable connection.</li>
</ul>
<p><strong>Step 2: AI Processing (The Brain - Gemini 1.5 Flash)</strong></p>
<ul>
<li>Use Basic LLM Chain node combined with Google Gemini Chat Model.</li>
</ul>
<p><strong>Prompt Engineering:</strong></p>
<blockquote>
<p>&quot;You are a virtual assistant. Extract the task name and deadline from the message. Today is {{ $now }}. Return a single JSON: <code>{&quot;task_name&quot;: &quot;...&quot;, &quot;due_date&quot;: &quot;YYYY-MM-DD HH:mm:ss&quot;}</code>.&quot;</p>
</blockquote>
<p><strong>Step 3: Data Parsing</strong>
Since AI returns text, I use a Code node (JavaScript) to convert it into a standard JSON Object.</p>
<pre><code class="language-javascript">const aiOutput = $input.item.json.text;
const jsonString = aiOutput.substring(aiOutput.indexOf(&#39;{&#39;), aiOutput.lastIndexOf(&#39;}&#39;) + 1);
return JSON.parse(jsonString);
</code></pre>
<p><strong>Step 4: Database Storage (Memory)</strong></p>
<ul>
<li>Use Postgres node to save data.</li>
<li>Use Upsert technique (Insert if not exists, Update if exists) to handle User ID.</li>
</ul>
<p><strong>Data Mapping:</strong></p>
<pre><code class="language-javascript">{{ [
  $(&#39;Telegram Trigger&#39;).item.json.message.chat.id,
  $(&#39;Telegram Trigger&#39;).item.json.message.chat.first_name,
  $(&#39;Code in JavaScript&#39;).item.json.task_name,
  $(&#39;Code in JavaScript&#39;).item.json.due_date
] }}
</code></pre>
<h3>5. Lessons Learned &amp; Troubleshooting üõ†Ô∏è</h3>
<p>During the process, I encountered HTTP 408 Request Timeout error when using n8n&#39;s default tunnel.</p>
<ul>
<li><strong>Cause:</strong> n8n&#39;s free tunnel is unstable in Vietnam.</li>
<li><strong>Solution:</strong> Switched to using <code>cloudflared</code> container (Quick Tunnel). Connection is much faster and more stable.</li>
<li><strong>Lesson:</strong> Always check Node names exactly when referencing variables (e.g., Code vs Code in JavaScript). One wrong letter and the system errors out immediately.</li>
</ul>
<h3>6. Current Results &amp; Next Steps üöÄ</h3>
<p>Currently, I can text: &quot;Submit English homework next Friday morning&quot; and the Bot automatically saves the correct date and time to the Database.
<strong>Next Steps (To-do list):</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Bot replies with confirmation message &quot;Saved&quot;.</li>
<li><input disabled="" type="checkbox"> Set up Cronjob to scan Database every 30 minutes.</li>
<li><input disabled="" type="checkbox"> Send reminder messages when due date is approaching (Notification).</li>
</ul>
<hr>
<h3>DevLog #1: T√¥i ƒë√£ x√¢y d·ª±ng &quot;Deadline Hunter&quot; b·∫±ng n8n v√† AI Gemini nh∆∞ th·∫ø n√†o? ü§ñ</h3>
<h3>1. √ù t∆∞·ªüng &amp; V·∫•n ƒë·ªÅ (The Problem) üí°</h3>
<p>L√† m·ªôt sinh vi√™n, n·ªói ƒëau l·ªõn nh·∫•t c·ªßa t√¥i l√† miss deadline. C√°c th√¥ng b√°o n·ªôp b√†i t·∫≠p, l·ªãch thi th∆∞·ªùng n·∫±m r·∫£i r√°c trong c√°c nh√≥m chat Zalo/Telegram, tr√¥i ƒëi r·∫•t nhanh v√† kh√¥ng ai nh·ªõ.</p>
<p>T√¥i quy·∫øt ƒë·ªãnh x√¢y d·ª±ng &quot;Deadline Hunter&quot; - m·ªôt con Bot th√¥ng minh. T√¥i ch·ªâ c·∫ßn forward tin nh·∫Øn ho·∫∑c g·ª≠i ·∫£nh ch·ª•p b·∫£ng cho n√≥. N√≥ s·∫Ω t·ª± ƒë·ªçc, t·ª± tr√≠ch xu·∫•t ng√†y gi·ªù v√† l∆∞u v√†o h·ªá th·ªëng ƒë·ªÉ nh·∫Øc nh·ªü t√¥i sau n√†y.</p>
<h3>2. Chu·∫©n b·ªã H·∫° t·∫ßng (Infrastructure as Code) üèóÔ∏è</h3>
<p>Thay v√¨ c√†i ƒë·∫∑t th·ªß c√¥ng, t√¥i s·ª≠ d·ª•ng Docker ƒë·ªÉ ƒë√≥ng g√≥i m·ªçi th·ª©. ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o m√¥i tr∆∞·ªùng dev gi·ªëng h·ªát m√¥i tr∆∞·ªùng deploy sau n√†y (T∆∞ duy DevSecOps).</p>
<p><strong>File <code>docker-compose.yml</code> &quot;th·∫ßn th√°nh&quot;</strong>
Sau nhi·ªÅu l·∫ßn fix l·ªói tunnel (l·ªói 408 timeout), ƒë√¢y l√† phi√™n b·∫£n ·ªïn ƒë·ªãnh nh·∫•t s·ª≠ d·ª•ng Cloudflare Quick Tunnel:</p>
<pre><code class="language-yaml">version: &#39;3.8&#39;

services:
  # 1. Database: N∆°i l∆∞u tr·ªØ b·ªô nh·ªõ
  postgres:
    image: postgres:15-alpine
    container_name: deadline-postgres
    restart: always
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin_password_123
      POSTGRES_DB: deadline_db
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
    networks:
      - app-network
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U admin -d deadline_db&quot;]
      interval: 5s
      timeout: 5s
      retries: 5

  # 2. Automation: B·ªô n√£o x·ª≠ l√Ω lu·ªìng
  n8n:
    image: n8nio/n8n:latest
    container_name: deadline-n8n
    restart: always
    ports:
      - &quot;5678:5678&quot;
    environment:
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - N8N_SECURE_COOKIE=false
      # Link n√†y s·∫Ω ƒëi·ªÅn sau khi Cloudflare kh·ªüi ƒë·ªông
      - WEBHOOK_URL=https://&lt;your-tunnel-url&gt;.trycloudflare.com
    volumes:
      - ./n8n_data:/home/node/.n8n
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # 3. Networking: ƒê∆∞·ªùng h·∫ßm ra Internet (Bypass NAT/Firewall)
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: deadline-tunnel
    restart: always
    command: tunnel --url http://n8n:5678
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
</code></pre>
<p><strong>C√°c l·ªánh CLI ƒë√£ d√πng:</strong></p>
<pre><code class="language-bash"># Kh·ªüi ch·∫°y h·ªá th·ªëng
sudo docker-compose up -d

# Xem log ƒë·ªÉ l·∫•y link Tunnel (quan tr·ªçng)
sudo docker logs -f deadline-tunnel

# Kh·ªüi ƒë·ªông l·∫°i ri√™ng n8n khi c·∫≠p nh·∫≠t Webhook URL
sudo docker-compose restart n8n
</code></pre>
<h3>3. Thi·∫øt k·∫ø C∆° s·ªü d·ªØ li·ªáu (Database Schema) üóÑÔ∏è</h3>
<p>T√¥i truy c·∫≠p v√†o container Postgres ƒë·ªÉ t·∫°o b·∫£ng. C·∫•u tr√∫c b·∫£ng ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ h·ªó tr·ª£ ƒë·ªãnh danh ng∆∞·ªùi d√πng qua Telegram ID.</p>
<p><strong>L·ªánh truy c·∫≠p DB:</strong></p>
<pre><code class="language-bash">docker exec -it deadline-postgres psql -U admin -d deadline_db
</code></pre>
<p><strong>Script SQL kh·ªüi t·∫°o:</strong></p>
<pre><code class="language-sql">-- B·∫£ng Users: L∆∞u ai l√† ai
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    telegram_chat_id VARCHAR(50) UNIQUE,
    full_name VARCHAR(255),
    email VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW()
);

-- B·∫£ng Tasks: L∆∞u vi·ªác c·∫ßn l√†m
CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    due_date TIMESTAMP,
    is_reminded BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);
</code></pre>
<h3>4. X√¢y d·ª±ng &quot;B·ªô n√£o&quot; AI trong n8n üß†</h3>
<p>ƒê√¢y l√† ph·∫ßn th√∫ v·ªã nh·∫•t. Quy tr√¨nh x·ª≠ l√Ω (Workflow) ƒëi qua 4 b∆∞·ªõc:</p>
<p><strong>B∆∞·ªõc 1: Telegram Trigger (ƒê√¥i tai)</strong></p>
<ul>
<li>Nh·∫≠n tin nh·∫Øn t·ª´ User.</li>
<li>S·ª≠ d·ª•ng Webhook t·ª´ Cloudflare Tunnel ƒë·ªÉ ƒë·∫£m b·∫£o k·∫øt n·ªëi ·ªïn ƒë·ªãnh.</li>
</ul>
<p><strong>B∆∞·ªõc 2: AI Processing (B·ªô n√£o - Gemini 1.5 Flash)</strong></p>
<ul>
<li>S·ª≠ d·ª•ng node Basic LLM Chain k·∫øt h·ª£p Google Gemini Chat Model.</li>
</ul>
<p><strong>Prompt Engineering (C√¢u l·ªánh cho AI):</strong></p>
<blockquote>
<p>&quot;B·∫°n l√† tr·ª£ l√Ω ·∫£o. Tr√≠ch xu·∫•t t√™n c√¥ng vi·ªác v√† deadline t·ª´ tin nh·∫Øn. H√¥m nay l√† {{ $now }}. Tr·∫£ v·ªÅ JSON duy nh·∫•t: <code>{&quot;task_name&quot;: &quot;...&quot;, &quot;due_date&quot;: &quot;YYYY-MM-DD HH:mm:ss&quot;}</code>.&quot;</p>
</blockquote>
<p><strong>B∆∞·ªõc 3: Data Parsing (X·ª≠ l√Ω d·ªØ li·ªáu)</strong>
V√¨ AI tr·∫£ v·ªÅ vƒÉn b·∫£n, t√¥i d√πng node Code (JavaScript) ƒë·ªÉ chuy·ªÉn n√≥ th√†nh JSON Object chu·∫©n.</p>
<pre><code class="language-javascript">const aiOutput = $input.item.json.text;
const jsonString = aiOutput.substring(aiOutput.indexOf(&#39;{&#39;), aiOutput.lastIndexOf(&#39;}&#39;) + 1);
return JSON.parse(jsonString);
</code></pre>
<p><strong>B∆∞·ªõc 4: Database Storage (B·ªô nh·ªõ)</strong></p>
<ul>
<li>S·ª≠ d·ª•ng node Postgres ƒë·ªÉ l∆∞u d·ªØ li·ªáu.</li>
<li>D√πng k·ªπ thu·∫≠t Upsert (Insert n·∫øu ch∆∞a c√≥, Update n·∫øu c√≥ r·ªìi) ƒë·ªÉ x·ª≠ l√Ω User ID.</li>
</ul>
<p><strong>Mapping d·ªØ li·ªáu:</strong></p>
<pre><code class="language-javascript">{{ [
  $(&#39;Telegram Trigger&#39;).item.json.message.chat.id,
  $(&#39;Telegram Trigger&#39;).item.json.message.chat.first_name,
  $(&#39;Code in JavaScript&#39;).item.json.task_name,
  $(&#39;Code in JavaScript&#39;).item.json.due_date
] }}
</code></pre>
<h3>5. Nh·ªØng b√†i h·ªçc &amp; Kh·∫Øc ph·ª•c s·ª± c·ªë (Troubleshooting) üõ†Ô∏è</h3>
<p>Trong qu√° tr√¨nh l√†m, t√¥i ƒë√£ g·∫∑p ph·∫£i l·ªói HTTP 408 Request Timeout khi d√πng tunnel m·∫∑c ƒë·ªãnh c·ªßa n8n.</p>
<ul>
<li><strong>Nguy√™n nh√¢n:</strong> Tunnel mi·ªÖn ph√≠ c·ªßa n8n kh√¥ng ·ªïn ƒë·ªãnh t·∫°i Vi·ªát Nam.</li>
<li><strong>Gi·∫£i ph√°p:</strong> Chuy·ªÉn sang d√πng container cloudflared (Quick Tunnel). K·∫øt n·ªëi nhanh v√† ·ªïn ƒë·ªãnh h∆°n h·∫≥n.</li>
<li><strong>B√†i h·ªçc:</strong> Lu√¥n ki·ªÉm tra t√™n Node ch√≠nh x√°c khi tham chi·∫øu bi·∫øn (V√≠ d·ª•: Code vs Code in JavaScript). Sai m·ªôt ch·ªØ l√† h·ªá th·ªëng b√°o l·ªói ƒë·ªè ngay.</li>
</ul>
<h3>6. K·∫øt qu·∫£ hi·ªán t·∫°i &amp; B∆∞·ªõc ti·∫øp theo üöÄ</h3>
<p>Hi·ªán t·∫°i, t√¥i ƒë√£ c√≥ th·ªÉ nh·∫Øn tin: &quot;N·ªôp b√†i Ti·∫øng Anh s√°ng th·ª© 6 tu·∫ßn sau&quot; v√† Bot t·ª± ƒë·ªông l∆∞u ƒë√∫ng ng√†y gi·ªù v√†o Database.</p>
<p><strong>Next Steps (To-do list):</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Bot ph·∫£n h·ªìi tin nh·∫Øn x√°c nh·∫≠n &quot;ƒê√£ l∆∞u&quot;.</li>
<li><input disabled="" type="checkbox"> Thi·∫øt l·∫≠p Cronjob qu√©t Database m·ªói 30 ph√∫t.</li>
<li><input disabled="" type="checkbox"> G·ª≠i tin nh·∫Øn nh·∫Øc nh·ªü khi s·∫Øp ƒë·∫øn h·∫°n (Notification).</li>
</ul>

        </div>
    </article>

    <div style="margin-top: 40px;">
        <a href="/dulkanggg/">&larr; Back to Home</a>
    </div>

    <footer>
    <p>&copy; 2025 Khang. All rights reserved.</p>
    <div class="social-links">
        <a href="https://github.com/khanchannn" target="_blank">GitHub</a>
        <a href="https://www.facebook.com/dulkanggg1504/" target="_blank">Facebook</a>
        <a href="mailto:dulkanggg1504@gmail.com">Email</a>
    </div>
</footer>
</div> <!-- End container -->
</body>

</html>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const codeBlocks = document.querySelectorAll('.post-content pre');

                codeBlocks.forEach(pre => {
                    const button = document.createElement('button');
                    button.className = 'copy-btn';
                    button.textContent = 'Copy';

                    button.addEventListener('click', () => {
                        const code = pre.querySelector('code').innerText;
                        navigator.clipboard.writeText(code).then(() => {
                            button.textContent = 'Copied!';
                            setTimeout(() => {
                                button.textContent = 'Copy';
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy:', err);
                            button.textContent = 'Error';
                        });
                    });

                    pre.appendChild(button);
                });
            });
        </script>